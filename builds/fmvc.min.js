var fmvc;(function(e){var t=function(){function e(){}return e.MODEL_CHANGED="model.changed",e.MODEL_CREATED="model.created",e.MODEL_VALIDATED="model.validated",e.MODEL_ADDED="model.added",e.MODEL_UPDATED="model.updated",e.MODEL_DELETED="model.deleted",e}();e.Event=t})(fmvc||(fmvc={})),define("../src/fmvc/event.js",function(){});var fmvc;(function(e){var t=function(){function t(t,n){n===void 0&&(n=null),this._disposed=!1,this._name=t,this._type=n?n:e.TYPE_MODEL}return Object.defineProperty(t.prototype,"facade",{get:function(){return this._facade},set:function(e){e?(this._facade=e,this.registerHandler()):(this.removeHandler(),this._facade=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disposed",{get:function(){return this._disposed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),t.prototype.sendEvent=function(e,t,n,r,i){t===void 0&&(t=null),n===void 0&&(n=null),r===void 0&&(r=null),i===void 0&&(i=!0);var s={name:e,sub:n,data:t,error:r,target:this};i&&this.log("Send event "+e),this._facade&&this._facade.eventHandler(s),this._listeners&&this._listeners.length&&this.sendToListners(e,t)},t.prototype.log=function(e,t){this._facade&&this._facade.sendLog(this.name,e,t)},t.prototype.registerHandler=function(){},t.prototype.removeHandler=function(){},t.prototype.addListener=function(e,t){this._listeners||(this._listeners=[]),this._listeners.push({target:e,handler:t})},t.prototype.bind=function(e,t,n){e?this.addListener(t,n):this.removeListener(t,n)},t.prototype.removeListener=function(e,t){var n=0;this._listeners.forEach(function(t,r){t.target===e&&(this.splice(r-n,1),n++)},this._listeners)},t.prototype.removeAllListeners=function(){this._listeners=null},t.prototype.sendToListners=function(e,t){this._listeners.forEach(function(n){n.target.disposed||n.handler.apply(n.target,[e,t])})},t.prototype.dispose=function(){this.facade=null,this._listeners=null,this._disposed=!0},t}();e.Notifier=t})(fmvc||(fmvc={})),define("../src/fmvc/notifier.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(e){function t(t,n){e.call(this,n),this._data=[],this._config={filter:[],length:1e5,console:!0},this._modules=[],console.log("Construct facade logger "),this.facade=t}return __extends(t,e),t.prototype.setConfig=function(e){this._config=e},t.prototype.console=function(e){this._config.console=e},t.prototype.setFilter=function(e){this._config.filter=e},t.prototype.modules=function(){return this._modules},t.prototype.saveLog=function(e,t,n){n===void 0&&(n=0);var r={name:e,message:t,level:n,date:new Date};this._data.push(r),this._data.length>this._config.length*2&&(this._data.length=this._data.slice(this._config.length)),this._modules.indexOf(e)===-1&&this._modules.push(e);if(this._config&&this._config.filter&&this._config.filter.length&&this._config.filter.indexOf(e)===-1)return;this._config&&this._config.console&&"console"in window&&console.log("["+e+"] "+n+" "+t),this.sendEvent("log",r,null,null,!1);return},t}(e.Notifier);e.Logger=t})(fmvc||(fmvc={})),define("../src/fmvc/logger.js",function(){});var fmvc;(function(e){e.VERSION="0.6.1",e.TYPE_MEDIATOR="mediator",e.TYPE_MODEL="model",e.TYPE_VIEW="view";var t=function(){function e(t){this._name="",this._objects=[],this._events={},this._name=t,e._facades.push(t)}return e.prototype.register=function(e){e.facade(this),this.log("Register "+e.name);if(this._objects.indexOf(e)<0){this._objects.push(e);if(e&&"events"in e){var t=e.events();for(var n in t){var r=t[n];this.log("Add event listener "+e.name),this._events[r]?this._events[r].push(e):this._events[r]=[e]}}}},e.prototype.getLogger=function(){return this._logger},e.prototype.getObject=function(e){for(var t in this._objects){var n=this._objects[t];if(n&&n.name===e)return n}return null},e.prototype.eventHandler=function(e){var t=this._events[e.name];for(var n in t){var r=t[n];r.eventHandler(e)}},e.prototype.log=function(e,t){this.sendLog(this._name,e,t)},e.prototype.sendLog=function(e,t,n){this._logger.saveLog(e,t,n)},e._facades=[],e}();e.Facade=t})(fmvc||(fmvc={})),define("../src/fmvc/facade.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(t){function n(n,r,i){r===void 0&&(r={}),i===void 0&&(i=!0),t.call(this,n),this._data=r,this._isEvents=i,i&&this.sendEvent(e.Event.MODEL_CREATED,this.data)}return __extends(n,t),Object.defineProperty(n.prototype,"data",{get:function(){return this._data},set:function(t){var n=this._data,r=null,i=!1;if(n)for(var s in t)n[s]!=t[s]&&(r||(r=[]),r.push(s),i=!0,n[s]=t[s]);else this._data=t;i&&this._isEvents&&this.sendEvent(e.Event.MODEL_CHANGED,this._data)},enumerable:!0,configurable:!0}),n.prototype.addValidator=function(e){this._validators=this._validators?this._validators:[];if(this._validators.indexOf(e)>=0)throw"Cant add validator to model";this._validators.push(e)},n.prototype.removeValidator=function(e){var t=this._validators?this._validators.indexOf(e):-1;t>=0&&this._validators.splice(t,1)},n.prototype.validate=function(t){var n=!1,r={};for(var i in this._validators){var s=this._validators[i];t=s.execute(t);if(!t){n=!1;break}}return this.sendEvent(e.Event.MODEL_VALIDATED,n,null,r),n},n.prototype.destroy=function(){},n}(e.Notifier);e.Model=t;var n=function(){function e(e,t){this.name=null,this.fnc=null,this.name=e,this.fnc=t}return e.prototype.execute=function(e){this.fnc.call(e,e)},e}();e.Validator=n})(fmvc||(fmvc={})),define("../src/fmvc/model.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(t){function n(n,r,i){i===void 0&&(i=null),t.call(this,r,e.TYPE_MEDIATOR),this.facade=n,this.initViews(i)}return __extends(n,t),n.prototype.initViews=function(e){if(e)if(e.length){for(var t in e)this.initView(e[t]);this.views=e}else this.initView(e),this.views=[e];else this.log("Has no views on init")},n.prototype.initView=function(e){this.log("Init view "+e.name),e.mediator=this,e.init()},n.prototype.getView=function(e){for(var t in this.views)if(this.views[t].name()==e)return this.views[t];return null},n.prototype.events=function(){return[]},n.prototype.internalHandler=function(e){e&&e.global?this.facade.eventHandler(e):this.eventHandler(e)},n.prototype.eventHandler=function(t){this.log("Handled "+t.name+" from "+t.target.name+":"+t.target.type);switch(t.target.type()){case e.TYPE_MEDIATOR:this.mediatorEventHandler(t);break;case e.TYPE_MODEL:this.modelEventHandler(t);break;case e.TYPE_VIEW:this.viewEventHandler(t)}},n.prototype.modelEventHandler=function(e){},n.prototype.mediatorEventHandler=function(e){},n.prototype.viewEventHandler=function(e){},n}(e.Notifier);e.Mediator=t})(fmvc||(fmvc={})),define("../src/fmvc/mediator.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){e.State={SELECTED:"selected",HOVERED:"hovered",FOCUSED:"focused",DISABLED:"disabled"},e.DomObjectType={TEXT:"text",TAG:"tag",COMMENT:"comment"};var t=function(t){function n(n,r){t.call(this,n,e.TYPE_VIEW),this.dynamicPropertyValue={},this.elementPaths={},this.handlers={},this._invalidateTimeout=0,this._invalidate=0,this._inDocument=!1,this._avaibleInheritedStates=null,this._locale="ru",_.bindAll(this,"getDataStringValue","applyEventHandlers"),this.$root=r,this.init(),this.invalidateHandler=this.invalidateHandler.bind(this)}return __extends(n,t),n.prototype.init=function(){},n.prototype.render=function(e){this.parentElement=e,this.createDom(),this.parentElement.appendChild(this.element),this.updateDom(),this.enterDocument(),this.updateChildren()},n.prototype.updateChildren=function(){},n.prototype.createDom=function(){this.element=document.createElement("div"),this.childrenContainer=this.element},n.prototype.createStates=function(e){this._states={},_.each(e,function(e){this._states[e]=!1},this)},n.prototype.updateDom=function(){if(!this.dynamicProperties)return;_.each(this._states,function(e,t){this.dynamicProperties[t]&&e!=this.dynamicPropertyValue[t]&&this.updateDynamicProperty(t,e)},this),this.updateI18N()},n.prototype.updateI18N=function(){if(!this.dynamicProperties)return;if(!this.i18n)return;_.each(this.i18n,function(e,t){if(!_.isObject(e)){var n="i18n.";this.dynamicProperties[n+t]?this.updateDynamicProperty(n+t,e):null}},this)},n.prototype.updateData=function(e,t,n){t===void 0&&(t="data."),n===void 0&&(n=0);if(!this.dynamicProperties||!e||!n)return;n--,_.each(e,function(e,r){var i=t+r+".";_.isObject(e)&&n?this.updateData(e,i,n):(console.log("Set data ",t+r),this.dynamicProperties[t+r]?this.updateDynamicProperty(t+r,e):null)},this)},n.prototype.getStyleValue=function(e){},n.prototype.getClassStringValue=function(e,t,n){return _.isBoolean(t)?n.replace("{"+e+"}",e):n.replace("{"+e+"}",t)},n.prototype.getDataStringValue=function(e,t,n){if(_.isString(n))return n.replace("{"+e+"}",t);if(_.isObject(n))return this.getDataObjectValue(e,t,n)},n.prototype.getDataObjectValue=function(e,t,n){if(n.method==="i18n"){if(!this.i18n[n.name])return"Error:View.getDataObjectValue has no i18n property";var r={};_.each(n.args,function(e,t){e&&(r[t]=this.data[e.replace("data.","")])},this);var i=this.getFormattedMessage(this.i18n[n.name],r);return n.source.replace("{replace}",i)}},n.prototype.updatePaths=function(e,t,n,r,i,s){_.each(e,function(e,o){var u="";if(_.isString(e)){var a=i(n,r,e);u+=a,s&&this.updatePathProperty(o,t,r,a)}else if(_.isArray(e))_.each(e,function(e){var a=i(n,r,e);u+=a,s&&this.updatePathProperty(o,t,r,e)},this);else if(_.isObject(e)){var a=i(n,r,e);u+=a,s&&this.updatePathProperty(o,t,r,a)}s||this.updatePathProperty(o,t,r,u)},this)},n.prototype.updateDynamicProperty=function(e,t){var n=this.dynamicProperties[e];this.dynamicPropertyValue[e]=t;if(!n)return;_.each(n,function(n,r){var i=null,s=!1;switch(r){case"class":i=this.getClassStringValue,s=!0;break;case"style":i=this.getClassStringValue;break;case"data":i=this.getDataStringValue;break;default:i=this.getDataStringValue}this.updatePaths(n,r,e,t,i,s)},this)},n.prototype.updatePathProperty=function(e,t,n,r){var i=this.elementPaths[e];if(!i||i.nodeType===8)return;switch(t){case"class":i.classList.toggle(r,n);break;case"style":var s=r.split(":"),o=s[0].trim();i.style[o]=s[1].trim();break;case"data":i.nodeType===3&&i.textContent!=r&&(i.textContent=r);break;default:i.setAttribute(t,r)}},n.prototype.getElementByPath=function(e,t,n){n===void 0&&(n=!1);if(!this.element)throw Error("cant get element by path");if(n)return e;if(t&&t.length&&e&&e.childNodes.length){var r=t.splice(0,1)[0];return this.getElementByPath(e.childNodes[parseInt(r,10)],t)}return e},Object.defineProperty(n.prototype,"inDocument",{get:function(){return this._inDocument},enumerable:!0,configurable:!0}),n.prototype.enterDocument=function(){if(this._inDocument)return;this._inDocument=!0,this.isDynamicStylesEnabled()||this.enableDynamicStyle(!0);var e=this;this.hasState("hover")&&(this.element.addEventListener("mouseover",function(){return e.setState("hover",!0)}),this.element.addEventListener("mouseout",function(){return e.setState("hover",!1)})),this.hasState("selected")&&this.element.addEventListener("click",function(){return e.setState("selected",!e.getState("selected"))}),this.enterDocumentElement(this.jsTemplate,this.elementPaths)},n.prototype.applyEventHandlers=function(e){var t=this.handlers[e.target][e.type];if(t==="stopPropagation")e.stopPropagation();else if(t.indexOf(",")){var n=t.split(",");if(n[0]==="set"){var r=n[1].split("."),i=r[1].trim();if(this.model){var s={};s[i]=e.target.value,this.model.data=s}this._data&&(this._data[i]=e.target.value)}}this.elementEventHandler(t,e)},n.prototype.elementEventHandler=function(e,t){console.log("Event to handle ",e)},n.prototype.enterDocumentElement=function(t,n){if(!t||!n)return;var r=n[t.path];t.type===e.DomObjectType.TAG&&(console.log("EnterDocument ",t.tagName,t.path),_.each(t.children,function(e,t){var r=this.enterDocumentElement(e,n)},this),t.handlers&&_.each(t.handlers,function(e,t){if(!this.handlers[r]||!this.handlers[r][t])this.handlers[r]||(this.handlers[r]={}),this.handlers[r][t]=e,console.log("add listener ",t),r.addEventListener(t,this.applyEventHandlers)},this))},n.prototype.applyChangeStateElement=function(e,t){if(!e||!t)return;var n=t[e.path];n&&_.each(e.children,function(e,n){this.applyChangeStateElement(e,t)},this);var r=!!e.states;if(!r)return;var i=e.states?this.isStateEnabled(e.states):!0,s=n.nodeType===1;if(i&&!s){var o=this.getElement(e,t),u=n.parentNode;u.replaceChild(o,n),t[e.path]=o,this.enterDocumentElement(e,t)}else if(!i&&s){var o=this.getElement(e,t),u=n.parentNode;u.replaceChild(o,n),t[e.path]=o}},n.prototype.exitDocument=function(){this._inDocument=!1,this.delegateEventHandlers(!1)},n.prototype.getFormattedMessage=function(e,t){return n.__formatter[e]=n.__formatter[e]?n.__formatter[e]:this.getCompiledFormatter(e),n.__formatter[e](t)},n.prototype.getCompiledFormatter=function(e){return n.__messageFormat[this.locale]=n.__messageFormat[this.locale]?n.__messageFormat[this.locale]:new MessageFormat(this.locale),n.__messageFormat[this.locale].compile(e)},n.prototype.delegateEventHandlers=function(e){},n.prototype.hasState=function(e){return _.isBoolean(this._states[e])},n.prototype.setState=function(e,t){if(!(e in this._states))return;if(this._states[e]===t)return;this._states[e]=t,this.applyState(e,t),this.applyChildrenState(e,t),this.applyChangeStateElement(this.jsTemplate,this.elementPaths)},n.prototype.getState=function(e){return this._states[e]},n.prototype.applyState=function(e,t){if(!this.dynamicProperties)return;this._inDocument&&this.updateDynamicProperty(e,t)},n.prototype.applyChildrenState=function(e,t){},n.prototype.applyChildState=function(){},Object.defineProperty(n.prototype,"avaibleInheritedStates",{get:function(){return this._avaibleInheritedStates?this._avaibleInheritedStates:(this._avaibleInheritedStates=_.filter(_.map(this._states,function(e,t){return t}),function(e){return this.inheritedStates.indexOf(e)>-1},this),this)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inheritedStates",{get:function(){return n.__inheritedStates},enumerable:!0,configurable:!0}),n.prototype.isSelected=function(){return!!this.getState(e.State.SELECTED)},n.prototype.isHovered=function(){return!!this.getState(e.State.HOVERED)},n.prototype.isFocused=function(){return!!this.getState(e.State.FOCUSED)},n.prototype.isDisabled=function(){return!!this.getState(e.State.DISABLED)},n.prototype.invalidate=function(e){this.removeInvalidateTimeout(),this._invalidate=this._invalidate|e,this.invalidateHandler()},n.prototype.invalidateHandler=function(){this.removeInvalidateTimeout();if(!this._invalidate||!this._inDocument)return;this._invalidate&1&&this.updateData(this.data,"data.",2),this._invalidate=0},n.prototype.removeInvalidateTimeout=function(){clearTimeout(this._invalidateTimeout),this._invalidateTimeout=null},Object.defineProperty(n.prototype,"mediator",{get:function(){return this._mediator},set:function(e){this._mediator=e},enumerable:!0,configurable:!0}),n.prototype.forEachChild=function(e){!this.childrenViews||!this.childrenViews.length,_.each(this.childrenViews,e,this)},n.prototype.addChild=function(e){this.childrenViews=this.childrenViews?this.childrenViews:[],this.childrenViews.push(e),e.render(this.childrenContainer)},n.prototype.removeChild=function(e){},n.prototype.removeAllChildren=function(){_.each(this.childrenViews,function(e){return e.dispose()});var e=this.childrenViews;return this.childrenViews=[],e},n.prototype.removeChildAt=function(e){},Object.defineProperty(n.prototype,"data",{get:function(){return this._data},set:function(e){console.log("View: set data",e),this._data=e,this.invalidate(1)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"model",{get:function(){return this._model},set:function(e){this._model=e,this.data=e.data},enumerable:!0,configurable:!0}),n.prototype.setModelWithListener=function(e){this.model=e,this.model.bind(!0,this,this.modelHandler)},n.prototype.modelHandler=function(e,t){this.log("modelHandler "+e),this.invalidate(1)},Object.defineProperty(n.prototype,"locale",{get:function(){return this._locale},set:function(e){this._locale=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"i18n",{get:function(){return null},enumerable:!0,configurable:!0}),n.prototype.sendEvent=function(e,t,n,r,i){t===void 0&&(t=null),n===void 0&&(n=null),r===void 0&&(r=null),i===void 0&&(i=!1),this._mediator&&this._mediator.internalHandler({name:e,data:t,global:i,target:this})},n.prototype.log=function(e,t){this._mediator&&this._mediator.facade.sendLog(this.name,e,t)},n.prototype.viewEventsHandler=function(e,t){this.log("event "+e),this.sendEvent(e,t)},n.prototype.eventHandler=function(e,t){this.viewEventsHandler(e,t)},n.prototype.dispose=function(){this.model&&this.model.bind(!1,this,this.modelHandler),this.delegateEventHandlers(!1),t.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"dynamicProperties",{get:function(){return this.jsTemplate?this.jsTemplate.dynamicSummary:null},enumerable:!0,configurable:!0}),n.prototype.isDynamicStylesEnabled=function(e){return _.isBoolean(e)&&(n.__isDynamicStylesEnabled=e),n.__isDynamicStylesEnabled},n.prototype.enableDynamicStyle=function(e){var t=this.className+"__"+Math.random()+"Style";if(e&&!this.isDynamicStylesEnabled()){var n=document.createElement("style");n.id=t,n.type="text/css",n.cssText=this.dynamicStyle,n.innerHTML=this.dynamicStyle,document.getElementsByTagName("head")[0].appendChild(n),this.isDynamicStylesEnabled(!0)}},Object.defineProperty(n.prototype,"dynamicStyle",{get:function(){return this.jsTemplate?this.jsTemplate.css:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"templateElement",{get:function(){return this.elementPaths={},this.getElement(this.jsTemplate,this.elementPaths)},enumerable:!0,configurable:!0}),n.prototype.isStateEnabled=function(e){var t=e.length;for(var n=0;n<t;n++){var r=e[n];return _.isArray(r)?this.getState(r[0])===r[1]:!!this.getState(e[n])}return!1},n.prototype.getElement=function(t,n){var r=null,i=t.states?this.isStateEnabled(t.states):!0;return i&&t.type===e.DomObjectType.TAG?(r=document.createElement(t.tagName),_.each(t.staticAttributes,function(e){r.setAttribute(e.name,e.value)}),_.each(t.children,function(e,t){var i=this.getElement(e,n);i&&r.appendChild(i)},this)):t.type===e.DomObjectType.TEXT?r=document.createTextNode(t.data||""):r=document.createComment(t.path),n[t.path]=r,r},Object.defineProperty(n.prototype,"jsTemplate",{get:function(){return n.__jsTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return n.__className},enumerable:!0,configurable:!0}),n.__isDynamicStylesEnabled=!1,n.__jsTemplate=null,n.__formatter={},n.__messageFormat={},n.__className="View",n.__inheritedStates=[e.State.DISABLED],n}(e.Notifier);e.View=t})(fmvc||(fmvc={})),define("../src/fmvc/view.js",function(){}),require(["../src/fmvc/event.js","../src/fmvc/notifier.js","../src/fmvc/logger.js","../src/fmvc/facade.js","../src/fmvc/model.js","../src/fmvc/mediator.js","../src/fmvc/view.js"],function(e,t,n,r,i,s,o){}),define("package.fmvc",function(){});