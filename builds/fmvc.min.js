/**
 * @file messageformat.js - ICU PluralFormat + SelectFormat for JavaScript
 * @author Alex Sexton - @SlexAxton
 * @version 0.3.0-0
 * @copyright 2012-2015 Alex Sexton, Eemeli Aro, and Contributors
 * @license To use or fork, MIT. To contribute back, Dojo CLA
 */

var fmvc;(function(e){var t=function(){function e(){}return e.MODEL_CHANGED="model.changed",e.MODEL_CREATED="model.created",e.MODEL_VALIDATED="model.validated",e.MODEL_ADDED="model.added",e.MODEL_UPDATED="model.updated",e.MODEL_DELETED="model.deleted",e}();e.Event=t})(fmvc||(fmvc={})),define("../src/fmvc/event.js",function(){});var fmvc;(function(e){var t=function(){function t(t,n){n===void 0&&(n=null),this._disposed=!1,this._name=t,this._type=n?n:e.TYPE_MODEL}return Object.defineProperty(t.prototype,"facade",{get:function(){return this._facade},set:function(e){e?(this._facade=e,this.registerHandler()):(this.removeHandler(),this._facade=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disposed",{get:function(){return this._disposed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),t.prototype.sendEvent=function(e,t,n,r,i){t===void 0&&(t=null),n===void 0&&(n=null),r===void 0&&(r=null),i===void 0&&(i=!0);var s={name:e,sub:n,data:t,error:r,target:this};i&&this.log("Send event "+e),this._facade&&this._facade.eventHandler(s),this._listeners&&this._listeners.length&&this._sendToListners(e,t)},t.prototype.log=function(e,t){return this._facade&&this._facade.logger.add(this.name,e,t),this},t.prototype.registerHandler=function(){},t.prototype.removeHandler=function(){},t.prototype.bind=function(e,t){return this.addListener(e,t),this},t.prototype.unbind=function(e,t){return this.removeListener(e,t),this},t.prototype.addListener=function(e,t){return this._listeners||(this._listeners=[]),this._listeners.push({target:e,handler:t}),this},t.prototype.removeListener=function(e,t){var n=0;return this._listeners.forEach(function(t,r){t.target===e&&(this.splice(r-n,1),n++)},this._listeners),this},t.prototype.removeAllListeners=function(){this._listeners=null},t.prototype._sendToListners=function(e,t){this._listeners.forEach(function(n){n.target.disposed||n.handler.apply(n.target,[e,t])})},t.prototype.dispose=function(){this.removeAllListeners(),this.facade=null,this._disposed=!0},t}();e.Notifier=t})(fmvc||(fmvc={})),define("../src/fmvc/notifier.js",function(){});var fmvc;(function(e){e.VERSION="0.8.0",e.TYPE_MEDIATOR="mediator",e.TYPE_MODEL="model",e.TYPE_VIEW="view",e.DefaultModel={locale:"locale",i18n:"i18n",theme:"theme",log:"log"};var t=function(){function t(n,r,i,s,o){i===void 0&&(i=""),s===void 0&&(s="ru"),o===void 0&&(o={}),this._name="",this._events={},this.model={},this.mediator={},this._name=n,this._root=r,t.__facades[n]=this;var u=new e.Logger(e.DefaultModel.log);this.register(u);var a=new e.Model(e.DefaultModel.locale,{value:s}),f=new e.Model(e.DefaultModel.theme,{value:i}),l=new e.Model(e.DefaultModel.i18n,o);this.register([a,l,f]),this.log("Старт приложения "+n+", fmvc версия "+e.VERSION),this.init()}return t.prototype.init=function(){},t.prototype.register=function(t){var n=this;if(_.isArray(t))_.each(t,this.register,this);else{var r=t;r.facade=this,this.log("Register "+r.name+", "+r.type);switch(r.type){case e.TYPE_MODEL:var i=r;this.model[r.name]=i;break;case e.TYPE_MEDIATOR:var s=r;this.mediator[r.name]=s,_.each(s.events,function(e){return n.addListener(s,e)},this)}}return this},t.prototype.unregister=function(t){if(_.isArray(t))_.each(t,this.unregister,this);else{var n=t;this.log("Unregister "+n.name+", "+n.type),n.dispose();switch(n.type){case e.TYPE_MODEL:delete this.model[n.name];break;case e.TYPE_MEDIATOR:delete this.model[n.name],this.removeListener(n)}}return this},t.prototype.addListener=function(e,t){return this._events[t]?this._events[t].push(e):this._events[t]=[e],this},t.prototype.removeListener=function(e,t){function n(t){t.indexOf(e)>-1&&(t=_.without(t,e))}return t?n(this._events[t]):_.each(this._events,n,this),this},Object.defineProperty(t.prototype,"locale",{get:function(){return this.model[e.DefaultModel.locale].data.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"theme",{get:function(){return this.model[e.DefaultModel.locale].data.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"i18n",{get:function(){return this.model[e.DefaultModel.i18n].data},enumerable:!0,configurable:!0}),t.prototype.eventHandler=function(e){var t=this._events[e.name];_.each(t,function(t){return t.eventHandler(e.name)})},Object.defineProperty(t.prototype,"logger",{get:function(){return this.model[e.DefaultModel.log]},enumerable:!0,configurable:!0}),t.prototype.log=function(e,t){return this.logger?this.logger.add(this._name,e,t):console.log(this._name,e,t),this},t.getInstance=function(e){return this.__facades[e]},t.__facades={},t}();e.Facade=t})(fmvc||(fmvc={})),define("../src/fmvc/facade.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(t){function n(n,r,i){r===void 0&&(r={}),t.call(this,n),this.enabledEvents=!0,this.watchChanges=!0,i&&_.extend(this,i),r&&(this.data=r),this.sendEvent(e.Event.MODEL_CREATED,this.data)}return __extends(n,t),Object.defineProperty(n.prototype,"data",{get:function(){return this._data},set:function(t){var r=this._data,i=null,s=!1;if(t instanceof n)throw Error("Cant set model data, data must be object, array or primitive");if(r)if(_.isString(r)||_.isNumber(r)||_.isBoolean(r))t!==r&&(s=!0,this._data=t);else if(_.isObject(r)&&this.watchChanges)for(var o in t)r[o]!==t[o]&&(i||(i={}),s=!0,i[o]=t[o],r[o]=t[o]);else this._data!==t&&(s=!0,this._data=_.isObject(t)?_.extend(this._data,t):t);else s=!0,this._data=t;s&&this.sendEvent(e.Event.MODEL_CHANGED,i||this._data)},enumerable:!0,configurable:!0}),n.prototype.sendEvent=function(e,n,r,i,s){n===void 0&&(n=null),r===void 0&&(r=null),i===void 0&&(i=null),s===void 0&&(s=!0),this.enabledEvents&&t.prototype.sendEvent.call(this,e,n,r,i,s)},n.prototype.destroy=function(){},n.prototype.addValidator=function(e){this._validators=this._validators?this._validators:[];if(this._validators.indexOf(e)>=0)throw"Cant add validator to model";this._validators.push(e)},n.prototype.removeValidator=function(e){var t=this._validators?this._validators.indexOf(e):-1;t>=0&&this._validators.splice(t,1)},n.prototype.validate=function(t){var n=!1,r={};for(var i in this._validators){var s=this._validators[i];t=s.execute(t);if(!t){n=!1;break}}return this.sendEvent(e.Event.MODEL_VALIDATED,n,null,r),n},n}(e.Notifier);e.Model=t;var n=function(){function e(e,t){this.name=null,this.fnc=null,this.name=e,this.fnc=t}return e.prototype.execute=function(e){this.fnc.call(e,e)},e}();e.Validator=n})(fmvc||(fmvc={})),define("../src/fmvc/model.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(t){function n(e,n){n===void 0&&(n=null),t.call(this,e),this.data=n}return __extends(n,t),Object.defineProperty(n.prototype,"data",{get:function(){return this._data},set:function(t){this._data||(this._data=[]);for(var n in t)this._data.push(this.createModel(t[n]));this.sendEvent(e.Event.MODEL_CHANGED,this.data)},enumerable:!0,configurable:!0}),n.prototype.createModel=function(t){return new e.Model(this.name+"-item",t)},n.prototype.add=function(t){return this._data.push(this.createModel(t)),this.sendEvent(e.Event.MODEL_CHANGED,this.data),!0},n.prototype.remove=function(t){var n=this._data,r=!1,i=n.indexOf(t);return i>-1&&(n.splice(i,1),r=!0),this.sendEvent(e.Event.MODEL_CHANGED,this.data),r},n.prototype.update=function(t){var n=this._data,r=!1,i=this.getIndexOfModelData(t);return i>-1&&(n[i].setData(t),r=!0),this.sendEvent(e.Event.MODEL_CHANGED,this.data),r},n.prototype.getIndexOfModelData=function(e){for(var t in this._data){var n=this._data[t];console.log("Check "+n.data+", "+e);if(n.data===e)return Number(t)}return-1},n}(e.Notifier);e.ModelList=t})(fmvc||(fmvc={})),define("../src/fmvc/model.list.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(e){function t(t,n){e.call(this,t,[],{enabledEvents:!1,watchChanges:!1}),this._config={filter:[],length:1e5,console:!0},this._modules=[],n&&(this.config=n),console.log("Construct facade logger ")}return __extends(t,e),Object.defineProperty(t.prototype,"config",{set:function(e){_.extend(this._config,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"console",{set:function(e){this._config.console=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{set:function(e){this._config.filter=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"modules",{get:function(){return this._modules},enumerable:!0,configurable:!0}),t.prototype.add=function(e,t,n){n===void 0&&(n=0);var r={name:e,message:t,level:n,date:new Date},i=this.data,s=this._config;i.push(r),this._modules.indexOf(e)===-1&&this._modules.push(e);if(s.filter&&s.filter.length&&s.filter.indexOf(e)===-1)return;return s&&s.console&&"console"in window&&console.log("["+e+"] "+n+" "+t),i.length>s.length*2&&i.splice(0,i.length-this._config.length),this.enabledEvents&&this.sendEvent("log",r,null,null,!1),this},t}(e.Model);e.Logger=t})(fmvc||(fmvc={})),define("../src/fmvc/logger.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(t){function n(n,r,i){t.call(this,n,e.TYPE_MEDIATOR),this._root=r,this.facade=i}return __extends(n,t),n.prototype.setRoot=function(e){return this._root=e,this},n.prototype.setFacade=function(e){return this.facade=e,this},n.prototype.addViews=function(e){if(e)if(_.isArray(e)){for(var t in e)this.initView(e[t]);this.views=e}else this.initView(e),this.views=[e];else this.log("Has no views to add");return this},n.prototype.initView=function(e){this.log("Init view "+e.name),e.mediator=this,e.render(this._root)},n.prototype.getView=function(e){for(var t in this.views)if(this.views[t].name()==e)return this.views[t];return null},Object.defineProperty(n.prototype,"events",{get:function(){return[]},enumerable:!0,configurable:!0}),n.prototype.internalHandler=function(e){e&&e.global?this.facade.eventHandler(e):this.eventHandler(e)},n.prototype.eventHandler=function(t){this.log("Handled "+t.name+" from "+t.target.name+":"+t.target.type);switch(t.target.type()){case e.TYPE_MEDIATOR:this.mediatorEventHandler(t);break;case e.TYPE_MODEL:this.modelEventHandler(t);break;case e.TYPE_VIEW:this.viewEventHandler(t)}},n.prototype.modelEventHandler=function(e){},n.prototype.mediatorEventHandler=function(e){},n.prototype.viewEventHandler=function(e){},n}(e.Notifier);e.Mediator=t})(fmvc||(fmvc={})),define("../src/fmvc/mediator.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){e.global=window||{},console.log("Global is "+e.global),e.State={SELECTED:"selected",HOVER:"hover",FOCUSED:"focused",DISABLED:"disabled"},e.DomObjectType={TEXT:"text",TAG:"tag",COMMENT:"comment"},e.Filter={FIRST:"first",SECOND:"second"};var t=function(t){function r(n,r,i){t.call(this,n,e.TYPE_VIEW),this.dynamicPropertyValue={},this.elementPaths={},this.componentPaths={},this.handlers={},this._invalidateTimeout=0,this._invalidate=0,this._inDocument=!1,this._avaibleInheritedStates=null,this._locale="ru",this._id=null,_.bindAll(this,"getDataStringValue","applyEventHandlers","invalidateHandler","getDataObjectValue"),this.template=this.jsTemplate,r&&(r.type===e.TYPE_MODEL?this.model=r:this.data=r),this.initTemplate(i),this.init(),this.invalidateHandler=this.invalidateHandler.bind(this)}return __extends(r,t),r.prototype.initTemplate=function(e){e&&(this.template=_.extend(_.clone(this.template),e)),console.log("template: ",this.template),this.template&&this.template.enableStates&&this.enableStates(this.template.enableStates)},r.prototype.init=function(){},r.prototype.render=function(e){this.parentElement=e,this.createDom(),this.parentElement.appendChild(this.element),this.updateDom(),this.enterDocument(),this.updateChildren()},r.prototype.updateChildren=function(){},Object.defineProperty(r.prototype,"id",{get:function(){return this._id||(this._id=(_.property("staticAttributes")(this.jsTemplate)?this.jsTemplate.staticAttributes.id:null)||n.getId()),this._id},enumerable:!0,configurable:!0}),r.prototype.createDom=function(){return this.element=document.createElement("div"),this.childrenContainer=this.element,this},r.prototype.enableStates=function(e){this._states={},this._statesType={},_.each(e,function(e){if(_.isString(e)){var t=e;this._states[t]=!1}else if(_.isObject(e)){var n=e;this._statesType[n.name]=n.type,this._states[n.name]=n.value}},this)},r.prototype.updateDom=function(){if(!this.dynamicProperties)return;_.each(this._states,function(e,t){this.dynamicProperties[t]&&e!=this.dynamicPropertyValue[t]&&this.updateDynamicProperty(t,e)},this),this.updateI18N()},r.prototype.updateI18N=function(){if(!this.dynamicProperties)return;if(!this.i18n)return;_.each(this.i18n,function(e,t){if(!_.isObject(e)){var n="i18n.";this.dynamicProperties[n+t]?this.updateDynamicProperty(n+t,e):null}},this)},r.prototype.updateData=function(e,t,n){t===void 0&&(t="data."),n===void 0&&(n=0);if(!this.dynamicProperties||!e||!n)return;n--,_.each(e,function(e,r){var i=t+r+".";_.isObject(e)&&n?this.updateData(e,i,n):this.dynamicProperties[t+r]?this.updateDynamicProperty(t+r,e):null},this)},r.prototype.getStyleValue=function(e){},r.prototype.getClassStringValue=function(e,t,n){return _.isBoolean(t)?n.replace("{"+e+"}",e):n.replace("{"+e+"}",t)},r.prototype.getDataStringValue=function(e,t,n){if(_.isString(n))return n.replace("{"+e+"}",t);if(_.isObject(n))return this.getDataObjectValue(e,t,n)},r.prototype.executeComplexFilter=function(e,t){},r.prototype.executeFilter=function(t,n){switch(t){case e.Filter.FIRST:return"first:"+n;case e.Filter.SECOND:return"second:"+n}return n},r.prototype.getDataObjectValue=function(e,t,n){var r=function(e,t){if(_.isArray(t)){if(t[0]==="i18n"){var r=t[1];if(!this.i18n[r])return"Error:View.getDataObjectValue has no i18n property";var i={};_.each(n.args,function(e,t){e&&(i[t]=this.data[e.replace("data.","")])},this);var s=this.getFormattedMessage(this.i18n[r],i);return n.source.replace("{replace}",s)}return this.executeComplexFilter(t,e)}return this.executeFilter(t,e)};return _.reduce(n.filters,r,t,this)},r.prototype.updatePaths=function(e,t,n,r,i,s){_.each(e,function(e,o){var u="";if(_.isString(e)){var a=i(n,r,e);u+=a,s&&this.updatePathProperty(o,t,r,a)}else if(_.isArray(e))_.each(e,function(e){var a=i(n,r,e);u+=a,s&&this.updatePathProperty(o,t,r,e)},this);else if(_.isObject(e)){var a=i(n,r,e);u+=a,s&&this.updatePathProperty(o,t,r,a)}s||this.updatePathProperty(o,t,r,u)},this)},r.prototype.updateDynamicProperty=function(e,t){var n=this.dynamicProperties[e];this.dynamicPropertyValue[e]=t;if(!n)return;_.each(n,function(n,r){var i=null,s=!1;switch(r){case"class":i=this.getClassStringValue,s=!0;break;case"style":i=this.getClassStringValue;break;case"data":i=this.getDataStringValue;break;default:i=this.getDataStringValue}this.updatePaths(n,r,e,t,i,s)},this)},r.prototype.updatePathProperty=function(e,t,n,r){var i=this.elementPaths[e];if(!i||i.nodeType===8)return;switch(t){case"class":i.classList.toggle(r,n);break;case"style":var s=r.split(":"),o=s[0].trim();i.style[o]=s[1].trim();break;case"data":i.nodeType===3&&i.textContent!=r&&(i.textContent=r);break;default:i.setAttribute(t,r)}},r.prototype.getElementByPath=function(e,t,n){n===void 0&&(n=!1);if(!this.element)throw Error("cant get element by path");if(n)return e;if(t&&t.length&&e&&e.childNodes.length){var r=t.splice(0,1)[0];return this.getElementByPath(e.childNodes[parseInt(r,10)],t)}return e},Object.defineProperty(r.prototype,"inDocument",{get:function(){return this._inDocument},enumerable:!0,configurable:!0}),r.prototype.enterDocument=function(){if(this._inDocument)return;this._inDocument=!0;var t=this;this.isDynamicStylesEnabled()||this.enableDynamicStyle(!0),n.checkElementAttribute(this.element,"id",this.id),this.hasState(e.State.HOVER)&&(this.dispatcher.listen(this.element,e.BrowserEvent.MOUSEOVER,function(){return t.setState(e.State.HOVER,!0)}),this.dispatcher.listen(this.element,e.BrowserEvent.MOUSEOUT,function(){return t.setState(e.State.HOVER,!1)})),this.hasState(e.State.SELECTED)&&this.dispatcher.listen(this.element,e.BrowserEvent.CLICK,function(){return t.setState(e.State.SELECTED,!t.getState(e.State.SELECTED))}),this.enterDocumentElement(this.jsTemplate,this.elementPaths),this.invalidate(1)},r.prototype.applyEventHandlers=function(e){var t=e.target.getAttribute("data-path"),n=this.handlers[t][e.type];e.stopPropagation();if(n==="stopPropagation")e.stopPropagation();else if(n.indexOf(",")){var r=n.split(",");if(r[0]==="set"){var i=r[1].split("."),s=i[1].trim();if(this.model){var o={};o[s]=e.target.value,this.model.data=o}this._data&&(this._data[s]=e.target.value)}}this.elementEventHandler(n,e)},r.prototype.elementEventHandler=function(e,t){console.log("Event to handle ",e)},r.prototype.enterDocumentElement=function(t,r){if(!t||!r)return;var i=t.path,s=r[t.path],o=s.nodeType===1,u=this.componentPaths[t.path];u&&u.enterDocument();if(t.type===e.DomObjectType.TAG&&o){_.each(t.children,function(e,t){this.enterDocumentElement(e,r)},this);if(t.handlers){var a=t.staticAttributes?t.staticAttributes.id:n.getId();n.checkElementAttribute(s,"id",a),_.each(t.handlers,function(e,t){if(!this.handlers[i]||!this.handlers[i][t])this.handlers[i]||(this.handlers[i]={}),this.handlers[i][t]=e,s.setAttribute("data-path",i),this.dispatcher.listen(s,t,this.applyEventHandlers)},this)}}},r.prototype.exitDocumentElement=function(t,n){if(!t||!n)return;var r=t.path,i=n[t.path],s=i.nodeType===1,o=this.componentPaths[t.path];o&&o.exitDocument(),t.type===e.DomObjectType.TAG&&s&&(_.each(t.children,function(e,t){this.exitDocumentElement(e,n)},this),t.handlers&&_.each(t.handlers,function(e,t){this.handlers[r]&&this.handlers[r][t]&&(this.dispatcher.unlisten(i,t),delete this.handlers[r][t])},this))},r.prototype.applyChangeStateElement=function(e,t){if(!e||!t)return;var n=t[e.path];n&&_.each(e.children,function(e,n){this.applyChangeStateElement(e,t)},this);var i=!!e.states;if(!i)return;var s=e.states?this.isStateEnabled(e.states):!0,o=n.nodeType===1;if(s&&!o){var u=this.getElement(e,t),a=n.parentNode;a.replaceChild(u,n),t[e.path]=u,this.enterDocumentElement(e,t),r.Counters.element.removed++}else if(!s&&o){this.exitDocumentElement(e,t);var u=this.getElement(e,t),a=n.parentNode;a.replaceChild(u,n),t[e.path]=u,r.Counters.element.removed++}},r.prototype.exitDocument=function(){this._inDocument=!1,this.delegateEventHandlers(!1)},r.prototype.getFormattedMessage=function(e,t){return r.__formatter[e]=r.__formatter[e]?r.__formatter[e]:this.getCompiledFormatter(e),r.__formatter[e](t)},r.prototype.getCompiledFormatter=function(e){return r.__messageFormat[this.locale]=r.__messageFormat[this.locale]?r.__messageFormat[this.locale]:new MessageFormat(this.locale),r.__messageFormat[this.locale].compile(e)},r.prototype.delegateEventHandlers=function(e){},r.prototype.hasState=function(e){return _.isBoolean(this._states[e])},r.prototype.setState=function(e,t){return e in this._states?(e in this._statesType&&(t=r.getTypedValue(t,this._statesType[e])),this._states[e]===t?this:(this._states[e]=t,this.applyState(e,t),this.applyChildrenState(e,t),this.applyChangeStateElement(this.jsTemplate,this.elementPaths),this)):this},r.prototype.getState=function(e){return this._states[e]},r.prototype.applyState=function(e,t){if(!this.dynamicProperties)return;this._inDocument&&this.updateDynamicProperty(e,t)},r.prototype.applyChildrenState=function(e,t){},r.prototype.applyChildState=function(){},Object.defineProperty(r.prototype,"avaibleInheritedStates",{get:function(){return this._avaibleInheritedStates||(this._avaibleInheritedStates=_.filter(_.map(this._states,function(e,t){return t}),function(e){return this.inheritedStates.indexOf(e)>-1},this)),this._avaibleInheritedStates},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inheritedStates",{get:function(){return r.__inheritedStates},enumerable:!0,configurable:!0}),r.prototype.isSelected=function(){return!!this.getState(e.State.SELECTED)},r.prototype.isHover=function(){return!!this.getState(e.State.HOVER)},r.prototype.isFocused=function(){return!!this.getState(e.State.FOCUSED)},r.prototype.isDisabled=function(){return!!this.getState(e.State.DISABLED)},r.prototype.invalidate=function(e){this._invalidate=this._invalidate|e,this._invalidateTimeout||(this._invalidateTimeout=setTimeout(this.invalidateHandler,20))},r.prototype.invalidateHandler=function(){this.removeInvalidateTimeout();if(!this._invalidate||!this._inDocument)return;this._invalidate&1&&this.updateData(this.data,"data.",2),this._invalidate=0},r.prototype.removeInvalidateTimeout=function(){clearTimeout(this._invalidateTimeout),this._invalidateTimeout=null},Object.defineProperty(r.prototype,"mediator",{get:function(){return this._mediator},set:function(e){this._mediator=e},enumerable:!0,configurable:!0}),r.prototype.forEachChild=function(e){if(!this.childrenViews||!this.childrenViews.length)return;_.each(this.childrenViews,e,this)},r.prototype.addChild=function(e){this.childrenViews=this.childrenViews?this.childrenViews:[],this.childrenViews.push(e),e.render(this.childrenContainer)},r.prototype.removeChild=function(e){},r.prototype.removeAllChildren=function(){_.each(this.childrenViews,function(e){return e.dispose()});var e=this.childrenViews;return this.childrenViews=[],e},r.prototype.removeChildAt=function(e){},Object.defineProperty(r.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e,this.invalidate(1)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"model",{get:function(){return this._model},set:function(e){this._model=e,this.data=e.data},enumerable:!0,configurable:!0}),r.prototype.setModelWithListener=function(e){this.model=e,this.model.bind(!0,this,this.modelHandler)},r.prototype.modelHandler=function(e,t){this.log("modelHandler "+e),this.invalidate(1)},Object.defineProperty(r.prototype,"locale",{get:function(){return this._locale},set:function(e){this._locale=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"i18n",{get:function(){return this.jsTemplate&&this.jsTemplate.i18n&&this.locale?this.jsTemplate.i18n[this.locale]:null},enumerable:!0,configurable:!0}),r.prototype.sendEvent=function(e,t,n,r,i){t===void 0&&(t=null),n===void 0&&(n=null),r===void 0&&(r=null),i===void 0&&(i=!1),this._mediator&&this._mediator.internalHandler({name:e,data:t,global:i,target:this})},r.prototype.log=function(e,t){this._mediator&&this._mediator.facade.logger.log(this.name,e,t)},r.prototype.viewEventsHandler=function(e,t){this.log("event "+e),this.sendEvent(e,t)},r.prototype.eventHandler=function(e,t){this.viewEventsHandler(e,t)},r.prototype.dispose=function(){this.model&&this.model.bind(!1,this,this.modelHandler),this.delegateEventHandlers(!1),t.prototype.dispose.call(this)},Object.defineProperty(r.prototype,"dynamicProperties",{get:function(){return this.jsTemplate?this.jsTemplate.dynamicSummary:null},enumerable:!0,configurable:!0}),r.prototype.isDynamicStylesEnabled=function(e){return!this.jsTemplate||!this.jsTemplate.css?!1:(_.isBoolean(e)&&(this.jsTemplate.css.enabled=e),this.jsTemplate.css.enabled)},r.prototype.enableDynamicStyle=function(e){var t=this.className+"__"+Math.random()+"Style";if(e&&!this.isDynamicStylesEnabled()){console.log(" *** enable dynamic style *** ",this.jsTemplate.css);var n=document.createElement("style");n.id=t,n.type="text/css",n.innerHTML=this.dynamicStyle,document.getElementsByTagName("head")[0].appendChild(n),this.isDynamicStylesEnabled(!0)}},Object.defineProperty(r.prototype,"dynamicStyle",{get:function(){return this.jsTemplate&&this.jsTemplate.css?this.jsTemplate.css.content:null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"templateElement",{get:function(){return this.elementPaths={},this.getElement(this.jsTemplate,this.elementPaths)},enumerable:!0,configurable:!0}),r.prototype.isStateEnabled=function(e){var t=e.length;for(var n=0;n<t;n++){var r=e[n];return _.isArray(r)?this.getState(r[0])===r[1]:!!this.getState(e[n])}return!1},r.prototype.getElement=function(t,n){var i=null,s=null,o=t.states?this.isStateEnabled(t.states):!0;if(o&&t.type===e.DomObjectType.TAG){if(t.tagName.indexOf(".")>-1){var u=new(e.global.ui[t.tagName.split(".")[1]]);this.componentPaths[t.path]=u,i=u.createDom().element}else i=document.createElement(t.tagName),_.each(t.staticAttributes,function(e,t){i.setAttribute(t,e)}),(t.handlers||String(t.path)==="0")&&i.setAttribute("id","id-"+r.Counters.element.added);_.each(t.children,function(e,t){var r=this.getElement(e,n);r&&i.appendChild(r)},this)}else t.type===e.DomObjectType.TEXT?s=document.createTextNode(t.data||""):s=document.createComment(t.path);return r.Counters.element.added++,n[t.path]=i||s,i||s},Object.defineProperty(r.prototype,"jsTemplate",{get:function(){return r.__jsTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return r.__className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dispatcher",{get:function(){return r.dispatcher},enumerable:!0,configurable:!0}),r.getTypedValue=function(t,n){switch(n){case e.Type.String:return _.isString(t)?t:String(t);case e.Type.Int:return parseInt(t,10);case e.Type.Float:return parseFloat(t);case e.Type.Boolean:return t===!0||t==="true"}},r.__isDynamicStylesEnabled=!1,r.__jsTemplate=null,r.__formatter={},r.__messageFormat={},r.__className="View",r.__inheritedStates=[e.State.DISABLED],r.Counters={element:{added:0,removed:0,handlers:0}},r.dispatcher=new e.EventDispatcher,r.Name="View",r}(e.Notifier);e.View=t;var n=function(){function e(){}return e.getId=function(e){return e===void 0&&(e=t.Name),"id_"+t.Counters.element.handlers++},e.checkElementAttribute=function(e,t,n){if(!e||!t)return;e.getAttribute(t)!==String(n)&&e.setAttribute(t,n)},e}();e.ViewHelper=n,setInterval(function(){console.log(JSON.stringify(t.Counters))},3e3)})(fmvc||(fmvc={})),define("../src/fmvc/view.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(e){function t(t,n){e.call(this,t,n)}return __extends(t,e),Object.defineProperty(t.prototype,"childrenConstructor",{set:function(e){this.ChildrenConstructor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataset",{get:function(){return this._dataset},set:function(e){this._dataset=e,this.invalidate(8)},enumerable:!0,configurable:!0}),t.prototype.applyChildrenState=function(e,t){if(!this.avaibleInheritedStates||this.avaibleInheritedStates.indexOf(e)===-1)return;this.forEachChild(function(n,r){this.applyViewState(e,t,n,r)})},t.prototype.applyViewState=function(e,t,n,r){n.setState(e,t)},t.prototype.updateChildren=function(){if(!this.inDocument)return;var e=this.removeAllChildren()||[];_.each(this.dataset,function(t,n){var r=e[n]||new this.ChildrenConstructor;r.data=t,_.each(this.avaibleInheritedStates,function(e){r.setState(e,this.getState(e))},this),r.inDocument||this.addChild(r)},this)},t}(e.View);e.ViewList=t})(fmvc||(fmvc={})),define("../src/fmvc/view.list.js",function(){}),function(e){function t(e,n,r){if(!e)this.lc=["en"];else if(typeof e=="string"){this.lc=[];for(var i=e;i;i=i.replace(/[-_]?[^-_]*$/,""))this.lc.push(i)}else this.lc=e;if(!n){n=t.getPluralFunc(this.lc);if(!n)throw"Plural function for locale `"+this.lc.join(",")+"` could not be loaded"}this.runtime.pluralFuncs={},this.runtime.pluralFuncs[this.lc[0]]=n,this.runtime.fmt={};if(r)for(var s in r)this.runtime.fmt[s]=r[s]}t.plurals={en:function(e){return e==1?"one":"other"},ru:function(e){var t=e|0;return t%10==1&&t%100!=11?"one":t%10>=2&&t%10<=4&&(t%100<12||t%100>14)?"few":t%10==0||t%10>=5&&t%10<=9||t%100>=11&&t%100<=14?"many":"other"}},t.getPluralFunc=function(n){var r=typeof require!="undefined"&&require("make-plural")||e.MakePlural||function(){return!1};for(var i=0;i<n.length;++i){var s=n[i];if(s in t.plurals)return t.plurals[s];var o=r(s,{ordinals:1,quiet:1});if(o)return t.plurals[s]=o,o}return null},t.formatters={number:function(e){return new Function("v,lc,p","return Intl.NumberFormat(lc,\n    p=='integer' ? {maximumFractionDigits:0}\n  : p=='percent' ? {style:'percent'}\n  : p=='currency' ? {style:'currency', currency:'"+(e.currency||"USD")+"', minimumFractionDigits:2, maximumFractionDigits:2}\n"+"  : {}).format(v)")},date:function(e,t,n){var r={day:"numeric",month:"short",year:"numeric"};switch(n){case"full":r.weekday="long";case"long":r.month="long";break;case"short":r.month="numeric"}return(new Date(e)).toLocaleDateString(t,r)},time:function(e,t,n){var r={second:"numeric",minute:"numeric",hour:"numeric"};switch(n){case"full":case"long":r.timeZoneName="short";break;case"short":delete r.minute}return(new Date(e)).toLocaleTimeString(t,r)}},t.prototype.setIntlSupport=function(e){return this.withIntlSupport=!!e||typeof e=="undefined",this},t.prototype.runtime={number:function(e,t){if(isNaN(e))throw new Error("'"+e+"' isn't a number.");return e-(t||0)},plural:function(e,t,n,r,i){if(e in r)return r[e];t&&(e-=t);var s=n(e,i);return s in r?r[s]:r.other},select:function(e,t){return e in t?t[e]:t.other},pluralFuncs:{},fmt:{},toString:function(){var e=function(t,r){if(typeof t!="object"){var i=t.toString().replace(/^(function )\w*/,"$1"),s=/([ \t]*)\S.*$/.exec(i);return s?i.replace(new RegExp("^"+s[1],"mg"),""):i}var o=[];for(var u in t)u!="toString"&&(r==0?o.push("var "+u+" = "+e(t[u],r+1)+";\n"):o.push(n(u)+": "+e(t[u],r+1)));if(r==0)return o.join("");if(o.length==0)return"{}";var s="  ";while(--r)s+="  ";return"{\n"+o.join(",\n").replace(/^/gm,s)+"\n}"};return e(this,0)}},t._parse=function(){var e=function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,r,i,s){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=s,this.name="SyntaxError"}function n(e){function xt(){return e.substring(mt,vt)}function Tt(){return mt}function Nt(){return At(mt).line}function Ct(){return At(mt).column}function kt(e){throw Mt(null,[{type:"other",description:e}],mt)}function Lt(e){throw Mt(e,null,mt)}function At(t){function n(t,n,r){var i,s;for(i=n;i<r;i++)s=e.charAt(i),s==="\n"?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):s==="\r"||s==="\u2028"||s==="\u2029"?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return gt!==t&&(gt>t&&(gt=0,yt={line:1,column:1,seenCR:!1}),n(yt,gt,t),gt=t),yt}function Ot(e){if(vt<bt)return;vt>bt&&(bt=vt,wt=[]),wt.push(e)}function Mt(n,r,i){function s(e){var t=1;e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});while(t<e.length)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r=new Array(e.length),i,s,o;for(o=0;o<e.length;o++)r[o]=e[o].description;return i=e.length>1?r.slice(0,-1).join(", ")+" or "+r[e.length-1]:r[0],s=t?'"'+n(t)+'"':"end of input","Expected "+i+" but "+s+" found."}var u=At(i),a=i<e.length?e.charAt(i):null;return r!==null&&s(r),new t(n!==null?n:o(r,a),r,a,i,u.line,u.column)}function _t(){var e;return e=Dt(),e}function Dt(){var e,t,n,i,s,u;e=vt,t=Ut();if(t!==r){n=[],i=vt,s=Pt(),s!==r?(u=Ut(),u!==r?(s=[s,u],i=s):(vt=i,i=o)):(vt=i,i=o);while(i!==r)n.push(i),i=vt,s=Pt(),s!==r?(u=Ut(),u!==r?(s=[s,u],i=s):(vt=i,i=o)):(vt=i,i=o);n!==r?(mt=e,t=a(t,n),e=t):(vt=e,e=o)}else vt=e,e=o;return e}function Pt(){var t,n,i,s,u,a,g;return t=vt,e.charCodeAt(vt)===123?(n=f,vt++):(n=r,Et===0&&Ot(l)),n!==r?(i=Jt(),i!==r?(s=zt(),s!==r?(u=vt,e.charCodeAt(vt)===44?(a=h,vt++):(a=r,Et===0&&Ot(p)),a!==r?(g=Ht(),g!==r?(a=[a,g],u=a):(vt=u,u=o)):(vt=u,u=o),u===r&&(u=c),u!==r?(a=Jt(),a!==r?(e.charCodeAt(vt)===125?(g=d,vt++):(g=r,Et===0&&Ot(v)),g!==r?(mt=t,n=m(s,u),t=n):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o),t}function Ht(){var t,n,i,s,u,a,f,l;t=vt,n=Jt(),n!==r?(e.substr(vt,6)===g?(i=g,vt+=6):(i=r,Et===0&&Ot(y)),i!==r?(s=Jt(),s!==r?(e.charCodeAt(vt)===44?(u=h,vt++):(u=r,Et===0&&Ot(p)),u!==r?(a=Jt(),a!==r?(f=Bt(),f!==r?(l=Jt(),l!==r?(mt=t,n=b(i,f),t=n):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o);if(t===r){t=vt,n=Jt(),n!==r?(e.substr(vt,13)===w?(i=w,vt+=13):(i=r,Et===0&&Ot(E)),i!==r?(s=Jt(),s!==r?(e.charCodeAt(vt)===44?(u=h,vt++):(u=r,Et===0&&Ot(p)),u!==r?(a=Jt(),a!==r?(f=Ft(),f!==r?(l=Jt(),l!==r?(mt=t,n=b(i,f),t=n):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o);if(t===r){t=vt,n=Jt(),n!==r?(e.substr(vt,6)===S?(i=S,vt+=6):(i=r,Et===0&&Ot(x)),i!==r?(s=Jt(),s!==r?(e.charCodeAt(vt)===44?(u=h,vt++):(u=r,Et===0&&Ot(p)),u!==r?(a=Jt(),a!==r?(f=Ft(),f!==r?(l=Jt(),l!==r?(mt=t,n=b(i,f),t=n):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o);if(t===r){t=vt,n=Jt();if(n!==r){i=zt();if(i!==r){s=[],u=Rt();while(u!==r)s.push(u),u=Rt();s!==r?(mt=t,n=T(i,s),t=n):(vt=t,t=o)}else vt=t,t=o}else vt=t,t=o}}}return t}function Bt(){var e,t,n,i;e=vt,t=jt(),t===r&&(t=c);if(t!==r){n=[],i=It();while(i!==r)n.push(i),i=It();n!==r?(mt=e,t=N(t,n),e=t):(vt=e,e=o)}else vt=e,e=o;return e}function jt(){var t,n,i,s,u,a,f,l;return t=vt,n=Jt(),n!==r?(e.substr(vt,6)===C?(i=C,vt+=6):(i=r,Et===0&&Ot(k)),i!==r?(s=Jt(),s!==r?(e.charCodeAt(vt)===58?(u=L,vt++):(u=r,Et===0&&Ot(A)),u!==r?(a=Jt(),a!==r?(f=Vt(),f!==r?(l=Jt(),l!==r?(mt=t,n=O(f),t=n):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o),t}function Ft(){var e,t,n;e=vt,t=[],n=It();while(n!==r)t.push(n),n=It();return t!==r&&(mt=e,t=M(t)),e=t,e}function It(){var t,n,i,s,u,a,c,h,p;return t=vt,n=Jt(),n!==r?(i=qt(),i!==r?(s=Jt(),s!==r?(e.charCodeAt(vt)===123?(u=f,vt++):(u=r,Et===0&&Ot(l)),u!==r?(a=Jt(),a!==r?(c=Dt(),c!==r?(h=Jt(),h!==r?(e.charCodeAt(vt)===125?(p=d,vt++):(p=r,Et===0&&Ot(v)),p!==r?(mt=t,n=_(i,c),t=n):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o),t}function qt(){var t,n,i;return t=vt,n=zt(),n!==r&&(mt=t,n=D(n)),t=n,t===r&&(t=vt,e.charCodeAt(vt)===61?(n=P,vt++):(n=r,Et===0&&Ot(H)),n!==r?(i=Vt(),i!==r?(mt=t,n=O(i),t=n):(vt=t,t=o)):(vt=t,t=o)),t}function Rt(){var t,n,i,s,u,a;return t=vt,n=Jt(),n!==r?(e.charCodeAt(vt)===44?(i=h,vt++):(i=r,Et===0&&Ot(p)),i!==r?(s=Jt(),s!==r?(u=zt(),u!==r?(a=Jt(),a!==r?(mt=t,n=B(u),t=n):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o),t}function Ut(){var e,t,n;e=vt,t=[],n=Wt(),n===r&&(n=Kt());while(n!==r)t.push(n),n=Wt(),n===r&&(n=Kt());return t!==r&&(mt=e,t=j(t)),e=t,e}function zt(){var t,n,i,s,u,a,f;Et++,t=vt,n=Jt();if(n!==r){i=vt,s=vt,I.test(e.charAt(vt))?(u=e.charAt(vt),vt++):(u=r,Et===0&&Ot(q));if(u!==r){a=[],R.test(e.charAt(vt))?(f=e.charAt(vt),vt++):(f=r,Et===0&&Ot(U));while(f!==r)a.push(f),R.test(e.charAt(vt))?(f=e.charAt(vt),vt++):(f=r,Et===0&&Ot(U));a!==r?(u=[u,a],s=u):(vt=s,s=o)}else vt=s,s=o;s!==r&&(s=e.substring(i,vt)),i=s,i!==r?(s=Jt(),s!==r?(mt=t,n=z(i),t=n):(vt=t,t=o)):(vt=t,t=o)}else vt=t,t=o;return Et--,t===r&&(n=r,Et===0&&Ot(F)),t}function Wt(){var e,t,n;e=vt,t=[],n=Xt();if(n!==r)while(n!==r)t.push(n),n=Xt();else t=o;return t!==r&&(mt=e,t=W(t)),e=t,e}function Xt(){var t,n,i,s,u,a;return t=vt,X.test(e.charAt(vt))?(n=e.charAt(vt),vt++):(n=r,Et===0&&Ot(V)),n!==r&&(mt=t,n=$(n)),t=n,t===r&&(t=vt,e.substr(vt,2)===J?(n=J,vt+=2):(n=r,Et===0&&Ot(K)),n!==r&&(mt=t,n=Q()),t=n,t===r&&(t=vt,e.substr(vt,2)===G?(n=G,vt+=2):(n=r,Et===0&&Ot(Y)),n!==r&&(mt=t,n=Z()),t=n,t===r&&(t=vt,e.substr(vt,2)===et?(n=et,vt+=2):(n=r,Et===0&&Ot(tt)),n!==r&&(mt=t,n=nt()),t=n,t===r&&(t=vt,e.substr(vt,2)===rt?(n=rt,vt+=2):(n=r,Et===0&&Ot(it)),n!==r?(i=$t(),i!==r?(s=$t(),s!==r?(u=$t(),u!==r?(a=$t(),a!==r?(mt=t,n=st(i,s,u,a),t=n):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o)):(vt=t,t=o))))),t}function Vt(){var t,n,i;t=vt,n=[],ot.test(e.charAt(vt))?(i=e.charAt(vt),vt++):(i=r,Et===0&&Ot(ut));if(i!==r)while(i!==r)n.push(i),ot.test(e.charAt(vt))?(i=e.charAt(vt),vt++):(i=r,Et===0&&Ot(ut));else n=o;return n!==r&&(mt=t,n=at(n)),t=n,t}function $t(){var t;return ft.test(e.charAt(vt))?(t=e.charAt(vt),vt++):(t=r,Et===0&&Ot(lt)),t}function Jt(){var e,t,n;Et++,e=vt,t=[],n=Kt();while(n!==r)t.push(n),n=Kt();return t!==r&&(mt=e,t=ht(t)),e=t,Et--,e===r&&(t=r,Et===0&&Ot(ct)),e}function Kt(){var t;return pt.test(e.charAt(vt))?(t=e.charAt(vt),vt++):(t=r,Et===0&&Ot(dt)),t}var n=arguments.length>1?arguments[1]:{},r={},i={start:_t},s=_t,o=r,u=[],a=function(e,t){var n=[];e&&e.val&&n.push(e);for(var r=0;r<t.length;r++)n.push(t[r][0]),t[r][1].val!==""&&n.push(t[r][1]);return{type:"messageFormatPattern",statements:n}},f="{",l={type:"literal",value:"{",description:'"{"'},c=null,h=",",p={type:"literal",value:",",description:'","'},d="}",v={type:"literal",value:"}",description:'"}"'},m=function(e,t){var n={type:"messageFormatElement",argumentIndex:e};return t&&t.length?n.elementFormat=t[1]:n.output=!0,n},g="plural",y={type:"literal",value:"plural",description:'"plural"'},b=function(e,t){return{type:"elementFormat",key:e,val:t}},w="selectordinal",E={type:"literal",value:"selectordinal",description:'"selectordinal"'},S="select",x={type:"literal",value:"select",description:'"select"'},T=function(e,t){return{type:"elementFormat",key:e,val:t}},N=function(e,t){return{type:"pluralFormatPattern",pluralForms:t,offset:e||0}},C="offset",k={type:"literal",value:"offset",description:'"offset"'},L=":",A={type:"literal",value:":",description:'":"'},O=function(e){return e},M=function(e){return{type:"selectFormatPattern",pluralForms:e}},_=function(e,t){return{type:"pluralForms",key:e,val:t}},D=function(e){return e},P="=",H={type:"literal",value:"=",description:'"="'},B=function(e){return e},j=function(e){return{type:"string",val:e.join("")}},F={type:"other",description:"identifier"},I=/^[0-9a-zA-Z$_]/,q={type:"class",value:"[0-9a-zA-Z$_]",description:"[0-9a-zA-Z$_]"},R=/^[^ \t\n\r,.+={}]/,U={type:"class",value:"[^ \\t\\n\\r,.+={}]",description:"[^ \\t\\n\\r,.+={}]"},z=function(e){return e},W=function(e){return e.join("")},X=/^[^{}\\\0-\x1F \t\n\r]/,V={type:"class",value:"[^{}\\\\\\0-\\x1F \\t\\n\\r]",description:"[^{}\\\\\\0-\\x1F \\t\\n\\r]"},$=function(e){return e},J="\\#",K={type:"literal",value:"\\#",description:'"\\\\#"'},Q=function(){return"\\#"},G="\\{",Y={type:"literal",value:"\\{",description:'"\\\\{"'},Z=function(){return"{"},et="\\}",tt={type:"literal",value:"\\}",description:'"\\\\}"'},nt=function(){return"}"},rt="\\u",it={type:"literal",value:"\\u",description:'"\\\\u"'},st=function(e,t,n,r){return String.fromCharCode(parseInt("0x"+e+t+n+r))},ot=/^[0-9]/,ut={type:"class",value:"[0-9]",description:"[0-9]"},at=function(e){return parseInt(e.join(""),10)},ft=/^[0-9a-fA-F]/,lt={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},ct={type:"other",description:"whitespace"},ht=function(e){return e.join("")},pt=/^[ \t\n\r]/,dt={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},vt=0,mt=0,gt=0,yt={line:1,column:1,seenCR:!1},bt=0,wt=[],Et=0,St;if("startRule"in n){if(!(n.startRule in i))throw new Error("Can't start parsing from rule \""+n.startRule+'".');s=i[n.startRule]}St=s();if(St!==r&&vt===e.length)return St;throw St!==r&&vt<e.length&&Ot({type:"end",description:"end of input"}),Mt(null,wt,bt)}return e(t,Error),{SyntaxError:t,parse:n}}();return e.parse.apply(e,arguments)};var n=function(e,t){if(/^[A-Z_$][0-9A-Z_$]*$/i.test(e))return t?t+"."+e:e;var n=JSON.stringify(e);return t?t+"["+n+"]":n};t.prototype._precompile=function(e,r){r=r||{keys:{},offset:{}};var i=[],s,o,u=[];switch(e.type){case"messageFormatPattern":for(s=0;s<e.statements.length;++s)i.push(this._precompile(e.statements[s],r));return o=i.join(" + ")||'""',r.pf_count?o:"function(d) { return "+o+"; }";case"messageFormatElement":return r.pf_count=r.pf_count||0,e.output?n(e.argumentIndex,"d"):(r.keys[r.pf_count]=e.argumentIndex,this._precompile(e.elementFormat,r));case"elementFormat":var u=[n(r.keys[r.pf_count],"d")];switch(e.key){case"select":return u.push(this._precompile(e.val,r)),"select("+u.join(", ")+")";case"selectordinal":return u=u.concat([0,n(this.lc[0],"pluralFuncs"),this._precompile(e.val,r),1]),"plural("+u.join(", ")+")";case"plural":return r.offset[r.pf_count||0]=e.val.offset||0,u=u.concat([r.offset[r.pf_count]||0,n(this.lc[0],"pluralFuncs"),this._precompile(e.val,r)]),"plural("+u.join(", ")+")";default:return this.withIntlSupport&&!(e.key in this.runtime.fmt)&&e.key in t.formatters&&(o=t.formatters[e.key],this.runtime.fmt[e.key]=typeof o(this)=="function"?o(this):o),u.push(JSON.stringify(this.lc)),e.val&&e.val.length&&u.push(JSON.stringify(e.val.length==1?e.val[0]:e.val)),"fmt."+e.key+"("+u.join(", ")+")"};case"pluralFormatPattern":case"selectFormatPattern":r.pf_count=r.pf_count||0,e.type=="selectFormatPattern"&&(r.offset[r.pf_count]=0);var a=!0;for(s=0;s<e.pluralForms.length;++s){var f=e.pluralForms[s].key;f==="other"&&(a=!1);var l=JSON.parse(JSON.stringify(r));l.pf_count++,i.push(n(f)+": "+this._precompile(e.pluralForms[s].val,l))}if(a)throw new Error("No 'other' form found in "+e.type+" "+r.pf_count);return"{ "+i.join(", ")+" }";case"string":return o='"'+(e.val||"").replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"',r.pf_count&&(u=[n(r.keys[r.pf_count-1],"d")],r.offset[r.pf_count-1]&&u.push(r.offset[r.pf_count-1]),o=o.replace(/(^|[^\\])#/g,'$1"+number('+u.join(", ")+')+"'),o=o.replace(/^""\+/,"").replace(/\+""$/,"")),o;default:throw new Error("Bad AST type: "+e.type)}},t.prototype.compile=function(e,r){var i={},s=this.lc,o=function(e,n){try{var r=t._parse(n);return e._precompile(r)}catch(i){throw new Error((r?"Precompiler":"Parser")+" error: "+i.toString())}},u=function(e,t){t||(t=0);if(typeof e!="object")return e;var r=[],i="";for(var s=0;s<t;++s)i+="  ";for(var o in e)r.push("\n"+i+"  "+n(o)+": "+u(e[o],t+1));return"{"+r.join(",")+"\n"+i+"}"};if(typeof e=="string"){var a=new Function("number, plural, select, pluralFuncs, fmt","return "+o(this,e));return a(this.runtime.number,this.runtime.plural,this.runtime.select,this.runtime.pluralFuncs,this.runtime.fmt)}r=r||{};for(var f in e){r.locale&&(this.lc=r.locale[f]&&[].concat(r.locale[f])||s);if(typeof e[f]=="string")try{i[f]=o(this,e[f])}catch(l){throw l.message=l.message.replace(":"," with `"+f+"`:"),l}else{i[f]={};for(var c in e[f])try{i[f][c]=o(this,e[f][c])}catch(l){throw l.message=l.message.replace(":"," with `"+c+"` in `"+f+"`:"),l}}}this.lc=s;var h=this.runtime.toString()+"\n";switch(r.global||""){case"exports":var p=[];for(var d in i)p.push(n(d,"exports")+" = "+u(i[d]));return new Function(h+p.join(";\n"));case"module.exports":return new Function(h+"module.exports = "+u(i));case"":return new Function(h+"return "+u(i));default:return new Function("G",h+n(r.global,"G")+" = "+u(i))}},typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=t),exports.MessageFormat=t):e.MessageFormat=t}(this),define("../src/contrib/messageformat.js",function(){}),require(["../src/fmvc/event.js","../src/fmvc/notifier.js","../src/fmvc/facade.js","../src/fmvc/model.js","../src/fmvc/model.list.js","../src/fmvc/logger.js","../src/fmvc/mediator.js","../src/fmvc/view.js","../src/fmvc/view.list.js","../src/contrib/messageformat.js"],function(e,t,n,r,i,s,o){console.log("fmvc with message format loaded")}),define("package.fmvc",function(){});