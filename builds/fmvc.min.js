//if(c) console.log('Create listeners ? ', c , e, value.handlers);

//if(c) console.log('Create listeners : ', c , e, value.handlers);

var fmvc;(function(e){var t=function(){function e(){}return e.MODEL_STATE_CHANGED="model.state.changed",e.MODEL_CHANGED="model.changed",e.MODEL_CREATED="model.created",e.MODEL_VALIDATED="model.validated",e.MODEL_ADDED="model.added",e.MODEL_UPDATED="model.updated",e.MODEL_DELETED="model.deleted",e}();e.Event=t})(fmvc||(fmvc={})),define("../src/fmvc/event.js",function(){});var fmvc;(function(e){var t=function(){function t(t,n){n===void 0&&(n=null),this._disposed=!1,this._name=t,this._type=n?n:e.TYPE_MODEL}return Object.defineProperty(t.prototype,"facade",{get:function(){return this._facade},set:function(e){e?(this._facade=e,this.registerHandler()):(this.removeHandler(),this._facade=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disposed",{get:function(){return this._disposed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),t.prototype.sendEvent=function(e,t,n,r,i){t===void 0&&(t=null),n===void 0&&(n=null),r===void 0&&(r=null),i===void 0&&(i=!0);var s={name:e,sub:n,data:t,error:r,target:this};this.log("Send event "+e),this._listeners&&this._listeners.length&&this._sendToListners(s),this._facade&&this._facade.eventHandler(s)},t.prototype.log=function(e,t){return this._facade&&this._facade.logger.add(this.name,e,t),this},t.prototype.registerHandler=function(){},t.prototype.removeHandler=function(){},t.prototype.bind=function(e,t){return this.addListener(e,t),this},t.prototype.unbind=function(e,t){return this.removeListener(e,t),this},t.prototype.addListener=function(e,t){this._listeners||(this._listeners=[]);var n=_.filter(this._listeners,function(e){return e.handler===t});return!n||!n.length?this._listeners.push({target:e,handler:t}):console.warn("Try duplicate listener of ",this.name),this},t.prototype.removeListener=function(e,t){var n=0;return this._listeners.forEach(function(t,r){t.target===e&&(this.splice(r-n,1),n++)},this._listeners),this},t.prototype.removeAllListeners=function(){this._listeners=null},t.prototype._sendToListners=function(e){this._listeners.forEach(function(t){t.target.disposed||t.handler.apply(t.target,[e])})},t.prototype.dispose=function(){this.removeAllListeners(),this.facade=null,this._disposed=!0},t}();e.Notifier=t})(fmvc||(fmvc={})),define("../src/fmvc/notifier.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){e.BrowserEvent={CLICK:"click",KEYUP:"keyup",KEYDOWN:"keydown",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",CHANGE:"change"},e.SpecialEvent={ACTION:"action",SWIPE:"swipe",PAN:"pan",PINCH:"pinch",TAP:"tap",DRAG:"drag"},e.browserElementEvents=[e.BrowserEvent.MOUSEOUT,e.BrowserEvent.MOUSEOVER,e.BrowserEvent.CLICK],e.browserWindowEvents=[e.BrowserEvent.KEYDOWN,e.BrowserEvent.KEYUP],e.specialEvents=[e.SpecialEvent.ACTION];var t=function(t){function n(){t.call(this,n.NAME,"controller"),this.executionMap={},this.windowHandlerMap={},_.bindAll(this,"browserHandler")}return __extends(n,t),n.prototype.listen=function(e,t,n,r){var i=e.getAttribute("id");if(!i||!t||!n){console.warn("Incorrect listener on ",e,i,t);return}this.executionMap[i]=this.executionMap[i]||{};var s={handler:n,context:r};return this.executionMap[i][t]?this.executionMap[i][t].push(s):this.executionMap[i][t]=[s],console.log("Create listener ",i,t,this.executionMap[i]),this.__createListener(e,i,t,n,r),this},n.prototype.__createListener=function(t,n,r,i,s){_.contains(e.browserWindowEvents,r)?this.__createWindowListener(t,r):_.contains(e.browserElementEvents,r)?this.__createElementListener(t,r):_.contains(e.specialEvents,r)?this.__createSpecialListener(t,r):console.warn("create listener for %s not found",r)},n.prototype.__removeListener=function(t,n,r){var n=n||t.getAttribute("id");_.contains(e.browserElementEvents,r)&&t.removeEventListener(r,this.browserHandler)},n.prototype.__createElementListener=function(e,t){e.addEventListener(t,this.browserHandler)},n.prototype.__createWindowListener=function(e,t){this.windowHandlerMap[t]||this.createWindowListener(t)},n.prototype.__createSpecialListener=function(e,t){console.warn("create special listener for %s not implemented",t)},n.prototype.unlistenAll=function(e){var t=e.getAttribute("id");if(!t)return;_.each(this.executionMap[t],function(t,n){e.removeEventListener(n,this.browserHandler),_.each(t,function(e){delete e.handler,delete e.context})},this),delete this.executionMap[t]},n.prototype.unlisten=function(e,t){var n=e.getAttribute("id");if(!n||!this.executionMap[n]){console.warn("Cant unlisten ",e,n,t);return}var r=this.executionMap[n][t];e.removeEventListener(t,this.browserHandler),_.each(r,function(e){delete e.handler,delete e.context}),delete this.executionMap[n][t]},n.prototype.browserHandler=function(e){var t=e.currentTarget||e.target,n=t.getAttribute("id"),r=e.type;if(!n)return;console.log(n,r,this.executionMap[n]);if(this.executionMap[n]&&this.executionMap[n][r]){var i=this.executionMap[n][r];_.each(i,function(t){t.handler.call(t.context,e)})}},n.prototype.createWindowListener=function(e){this.windowHandlerMap[e]=!0,window.addEventListener(e,this.browserHandler,!0)},n.NAME="EventDispatcher",n}(e.Notifier);e.EventDispatcher=t})(fmvc||(fmvc={})),define("../src/fmvc/event.dispatcher.js",function(){});var fmvc;(function(e){e.VERSION="0.8.0",e.TYPE_MEDIATOR="mediator",e.TYPE_MODEL="model",e.TYPE_VIEW="view",e.DefaultModel={locale:"locale",i18n:"i18n",theme:"theme",log:"log"};var t=function(){function t(n,r,i,s,o){i===void 0&&(i=""),s===void 0&&(s="ru"),o===void 0&&(o={}),this._name="",this._events={},this.model={},this.mediator={},this._name=n,this._root=r,t.__facades[n]=this;var u=new e.Logger(e.DefaultModel.log);this.register(u);var a=new e.Model(e.DefaultModel.locale,{value:s}),f=new e.Model(e.DefaultModel.theme,{value:i}),l=new e.Model(e.DefaultModel.i18n,o);this.register([a,l,f]),this.log("Старт приложения "+n+", fmvc версия "+e.VERSION),this.init()}return t.prototype.init=function(){},t.prototype.register=function(t){var n=this;if(_.isArray(t))_.each(t,this.register,this);else{var r=t;r.facade=this,this.log("Register "+r.name+", "+r.type);switch(r.type){case e.TYPE_MODEL:var i=r;this.model[r.name]=i;break;case e.TYPE_MEDIATOR:var s=r;this.mediator[r.name]=s,_.each(s.events,function(e){return n.addListener(s,e)},this)}}return this},t.prototype.unregister=function(t){if(_.isArray(t))_.each(t,this.unregister,this);else{var n=t;this.log("Unregister "+n.name+", "+n.type),n.dispose();switch(n.type){case e.TYPE_MODEL:delete this.model[n.name];break;case e.TYPE_MEDIATOR:delete this.model[n.name],this.removeListener(n)}}return this},t.prototype.addListener=function(e,t){return this._events[t]?this._events[t].push(e):this._events[t]=[e],this},t.prototype.removeListener=function(e,t){function n(t){t.indexOf(e)>-1&&(t=_.without(t,e))}return t?n(this._events[t]):_.each(this._events,n,this),this},Object.defineProperty(t.prototype,"locale",{get:function(){return this.model[e.DefaultModel.locale].data.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"theme",{get:function(){return this.model[e.DefaultModel.locale].data.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"i18n",{get:function(){return this.model[e.DefaultModel.i18n].data},enumerable:!0,configurable:!0}),t.prototype.eventHandler=function(e){var t=this._events[e.name];_.each(t,function(t){return t.eventHandler(e)})},Object.defineProperty(t.prototype,"logger",{get:function(){return this.model[e.DefaultModel.log]},enumerable:!0,configurable:!0}),t.prototype.log=function(e,t){return this.logger?this.logger.add(this._name,e,t):console.log(this._name,e,t),this},t.getInstance=function(e){return this.__facades[e]},t.__facades={},t}();e.Facade=t})(fmvc||(fmvc={})),define("../src/fmvc/facade.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){e.ModelState={None:"none",Parsing:"parsing",Parsed:"parsed",Loading:"loading",Loaded:"loaded",Updating:"updating",Syncing:"syncing",Synced:"synced",Changed:"changed",Error:"error"};var t=function(t){function r(n,r,i){r===void 0&&(r={}),t.call(this,n),this.enabledEvents=!0,this.enabledState=!0,this.watchChanges=!0,i&&_.extend(this,i),r&&(this.data=r),this.sendEvent(e.Event.MODEL_CREATED,this.data)}return __extends(r,t),r.prototype.setState=function(t){return!this.enabledState||this._state===t?this:(this._previousState=t,this._state=t,this.log("New state: "+t),this.sendEvent(e.Event.MODEL_CHANGED,this._state),this)},r.prototype.parseValue=function(t){var n=null,i=this.data,s=null,o=!1;if(t instanceof r)throw console.log(t),this.log("Check errors in this"),Error("Cant set model data, data must be object, array or primitive");if(_.isObject(i)&&_.isObject(t)&&this.watchChanges){for(var u in t)i[u]!==t[u]&&(s||(s={}),o=!0,s[u]=t[u],i[u]=t[u]);o&&this.sendEvent(e.Event.MODEL_CHANGED,s),n=i}else i!==t&&(n=_.isObject(i)&&_.isObject(t)?_.extend({},i,t):t);return n},r.prototype.reset=function(){this._data=null},Object.defineProperty(r.prototype,"data",{get:function(){return this._data},set:function(t){var n=this._data,r=this.parseValue(t);n!==r&&(console.log("["+this.name+"]: New prev, new data "+this._data+", "+r),this._data=r,this.sendEvent(e.Event.MODEL_CHANGED,this.data))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),r.prototype.sendEvent=function(e,n,r,i,s){n===void 0&&(n=null),r===void 0&&(r=null),i===void 0&&(i=null),s===void 0&&(s=!0),this.enabledEvents&&t.prototype.sendEvent.call(this,e,n,r,i,s)},r.prototype.destroy=function(){},Object.defineProperty(r.prototype,"queue",{get:function(){return new n(this)},enumerable:!0,configurable:!0}),r.prototype.addValidator=function(e){this._validators=this._validators?this._validators:[];if(this._validators.indexOf(e)>=0)throw"Cant add validator to model";this._validators.push(e)},r.prototype.removeValidator=function(e){var t=this._validators?this._validators.indexOf(e):-1;t>=0&&this._validators.splice(t,1)},r.prototype.validate=function(t){var n=!1,r={};for(var i in this._validators){var s=this._validators[i];t=s.execute(t);if(!t){n=!1;break}}return this.sendEvent(e.Event.MODEL_VALIDATED,n,null,r),n},r}(e.Notifier);e.Model=t;var n=function(){function t(e){this.model=e}return t.prototype.load=function(t){return this.model.setState(e.ModelState.Loading),this.async($.ajax,[t],$,{done:e.ModelState.Loaded,fault:e.ModelState.Error}),this},t.prototype.loadXml=function(e){var t=_.defaults(e,{method:"GET",dataType:"xml",data:{rnd:Math.round(Math.random()*1e6)}});return this.load(t)},t.prototype.parse=function(t){return this.model.setState(e.ModelState.Parsing),this.sync(t,[this.model],this,{done:e.ModelState.Parsed,fault:e.ModelState.Error}),this},t.prototype.async=function(e,t,n,r){var i=$.Deferred(),s=this.setup();return s.then(function(s){console.log("Call async method args ",t),e.apply(n,t).then(function(t){console.log("Async success ",t),i.resolve(t)},function(t){console.log("Async fault ",arguments),i.reject(t)})},function(){i.reject()}),this.currentPromise=i.promise(),this},t.prototype.sync=function(e,t,n,r){var i=$.Deferred(),s=this.setup();return s.done(function(s){var o=[s].concat(t),u=e.apply(n,o);console.log("Call sync method ",u," args ",o),u?i.resolve(u):i.reject()}),this.currentPromise=i.promise(),this},t.prototype.complete=function(e,t,n,r){this.sync(e,n,t,r)},t.prototype.setup=function(){var e=$.Deferred();return $.when(this.currentPromise).then(function(n){e.resolve(n)},function(){e.reject()}),e.promise()},t}();e.ModelQueue=n;var r=function(){function e(e,t){this.name=null,this.fnc=null,this.name=e,this.fnc=t}return e.prototype.execute=function(e){this.fnc.call(e,e)},e}();e.Validator=r})(fmvc||(fmvc={})),define("../src/fmvc/model.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(t){function n(e,n,r){n===void 0&&(n=[]),t.call(this,e,n,r)}return __extends(n,t),n.prototype.parseValue=function(t){if(!_.isArray(t))throw Error("Cant set modelList from not array data");var n=[];return _.each(t,function(t){var r=t instanceof e.Model?t:this.getModel(t);n.push(r)},this),n},n.prototype.getModel=function(t){return new e.Model(this.name+"-item",t)},Object.defineProperty(n.prototype,"count",{get:function(){var e=this.data;return e&&e.length?e.length:0},enumerable:!0,configurable:!0}),n}(e.Model);e.ModelList=t})(fmvc||(fmvc={})),define("../src/fmvc/model.list.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(e){function t(t,n){e.call(this,t,[],{enabledEvents:!1,watchChanges:!1}),this._config={filter:[],length:1e5,console:!0},this._modules=[],n&&(this.config=n),console.log("Construct facade logger ")}return __extends(t,e),Object.defineProperty(t.prototype,"config",{set:function(e){_.extend(this._config,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"console",{set:function(e){this._config.console=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{set:function(e){this._config.filter=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"modules",{get:function(){return this._modules},enumerable:!0,configurable:!0}),t.prototype.add=function(e,t,n){n===void 0&&(n=0);var r={name:e,message:t,level:n,date:new Date},i=this.data,s=this._config;i.push(r),this._modules.indexOf(e)===-1&&this._modules.push(e);if(s.filter&&s.filter.length&&s.filter.indexOf(e)===-1)return;return s&&s.console&&"console"in window&&console.log("["+e+"] "+n+" "+t),i.length>s.length*2&&i.splice(0,i.length-this._config.length),this.enabledEvents&&this.sendEvent("log",r,null,null,!1),this},t}(e.Model);e.Logger=t})(fmvc||(fmvc={})),define("../src/fmvc/logger.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(t){function n(n,r,i){t.call(this,n,e.TYPE_MEDIATOR),this._root=r,this.facade=i}return __extends(n,t),n.prototype.setRoot=function(e){return this._root=e,this},n.prototype.setFacade=function(e){return this.facade=e,this},n.prototype.addViews=function(e){if(e)if(_.isArray(e)){for(var t in e)this.initView(e[t]);this.views=e}else this.initView(e),this.views=[e];else this.log("Has no views to add");return this},n.prototype.initView=function(e){this.log("Init view "+e.name),e.mediator=this,e.render(this._root)},n.prototype.getView=function(e){for(var t in this.views)if(this.views[t].name==e)return this.views[t];return null},Object.defineProperty(n.prototype,"events",{get:function(){return[]},enumerable:!0,configurable:!0}),n.prototype.internalHandler=function(e){e&&e.global?this.facade.eventHandler(e):this.eventHandler(e)},n.prototype.eventHandler=function(t){switch(t&&t.target?t.target.type:null){case e.TYPE_MEDIATOR:this.mediatorEventHandler(t);break;case e.TYPE_MODEL:this.modelEventHandler(t);break;case e.TYPE_VIEW:this.viewEventHandler(t)}},n.prototype.modelEventHandler=function(e){},n.prototype.mediatorEventHandler=function(e){},n.prototype.viewEventHandler=function(e){},n}(e.Notifier);e.Mediator=t})(fmvc||(fmvc={})),define("../src/fmvc/mediator.js",function(){});var fmvc;(function(e){e.Type={String:"string",Int:"int",Float:"float",Boolean:"boolean"}})(fmvc||(fmvc={})),define("../src/fmvc/view.i.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(fmvc){fmvc.global=window||{},console.log("Global is "+fmvc.global),fmvc.State={SELECTED:"selected",HOVER:"hover",FOCUSED:"focused",DISABLED:"disabled"},fmvc.DomObjectType={TEXT:"text",TAG:"tag",COMMENT:"comment"},fmvc.Filter={FIRST:"first",SECOND:"second"};var View=function(_super){function View(e,t,n){_super.call(this,e,fmvc.TYPE_VIEW),this._data=null,this.dynamicPropertyValue={},this.elementPaths={},this.componentPaths={},this.handlers={},this._invalidateTimeout=0,this._invalidate=0,this._inDocument=!1,this._avaibleInheritedStates=null,this._locale="ru",this._id=null,_.bindAll(this,"getDataStringValue","applyEventHandlers","invalidateHandler","appModelHandler"),this.template=this.jsTemplate,t&&(t.type===fmvc.TYPE_MODEL?this.model=t:this.data=t),this.initTemplate(n),this.init(),this.invalidateHandler=this.invalidateHandler.bind(this)}return __extends(View,_super),View.prototype.initTemplate=function(e){e&&(this.template=_.extend(_.clone(this.template),e)),this.template&&this.template.enableStates&&this.enableStates(this.template.enableStates)},View.prototype.init=function(){},View.prototype.render=function(e){this.parentElement=e,this.createDom(),this.parentElement.appendChild(this.element),this.updateDom(),this.enterDocument(),this.updateChildren()},View.prototype.updateChildren=function(){},Object.defineProperty(View.prototype,"id",{get:function(){return this._id||(this._id=(_.property("staticAttributes")(this.jsTemplate)?this.jsTemplate.staticAttributes.id:null)||ViewHelper.getId()),this._id},enumerable:!0,configurable:!0}),View.prototype.createDom=function(){return this.element=document.createElement("div"),this.childrenContainer=this.element,this},View.prototype.enableStates=function(e){this._states={},this._statesType={},_.each(e,function(e){if(_.isString(e)){var t=e;this._states[t]=!1}else if(_.isObject(e)){var n=e;this._statesType[n.name]=n.type,this._states[n.name]=n.value||n.default}},this)},View.prototype.updateDom=function(){if(!this.dynamicProperties)return;_.each(this._states,function(e,t){this.dynamicProperties[t]&&e!=this.dynamicPropertyValue[t]&&this.updateDynamicProperty(t,e)},this),this.updateI18N()},View.prototype.updateI18N=function(){if(!this.dynamicProperties)return;if(!this.i18n)return;_.each(this.i18n,function(e,t){if(!_.isObject(e)){var n="i18n.";this.dynamicProperties[n+t]?this.updateDynamicProperty(n+t,e):null}},this)},View.prototype.updateData=function(e,t,n){t===void 0&&(t="data."),n===void 0&&(n=0);if(!this.dynamicProperties||!e||!n)return;n--,_.each(e,function(e,r){var i=t+r+".";_.isObject(e)&&n?this.updateData(e,i,n):this.dynamicProperties[t+r]?this.updateDynamicProperty(t+r,e):null},this)},View.prototype.updateApp=function(){if(!this.dynamicProperties||!this.app)return;var e=_.filter(_.keys(this.dynamicProperties),function(e){return e.indexOf("app.")===0});_.each(e,function(e){this.updateAppProp(e)},this)},View.prototype.updateAppProp=function(name){var appValue=eval("this."+name);this.updateDynamicProperty(name,appValue)},View.prototype.getStyleValue=function(e){},View.prototype.getClassStringValue=function(e,t,n){return _.isBoolean(t)?n.replace("{"+e+"}",e):n.replace("{"+e+"}",t)},View.prototype.getDataStringValue=function(e,t,n){if(_.isString(n))return n.replace("{"+e+"}",t);if(_.isObject(n))return this.executeMultiExpression(n)},View.prototype.executeFilters=function(e,t){return!t||!t.length?e:_.reduce(t,function(e,t,n){return t.indexOf("i18n.")===0?this.getFormattedMessage(this.i18n[t.replace("i18n.","")],e):this.executePlainFilter(t,e)},e,this)},View.prototype.executePlainFilter=function(e,t){switch(e){case"hhmmss":return ViewHelper.hhmmss(t);case fmvc.Filter.FIRST:return"first:"+t;case fmvc.Filter.SECOND:return"second:"+t}return t},View.prototype.updatePaths=function(e,t,n,r,i,s){_.each(e,function(e,o){var u="";if(_.isString(e)){var a=i(n,r,e);u+=a,s&&this.updatePathProperty(o,t,r,a)}else if(_.isArray(e))_.each(e,function(e){var a=i(n,r,e);u+=a,s&&this.updatePathProperty(o,t,r,e)},this);else if(_.isObject(e)){var a=i(n,r,e);u+=a,s&&this.updatePathProperty(o,t,r,a)}s||this.updatePathProperty(o,t,r,u)},this)},View.prototype.updateDynamicProperty=function(e,t){var n=this.dynamicProperties[e];this.dynamicPropertyValue[e]=t;if(!n)return;_.each(n,function(n,r){var i=null,s=!1;switch(r){case"class":i=this.getClassStringValue,s=!0;break;case"style":i=this.getDataStringValue;break;case"data":i=this.getDataStringValue;break;default:i=this.getDataStringValue}this.updatePaths(n,r,e,t,i,s)},this)},View.prototype.updatePathProperty=function(e,t,n,r){var i=this.elementPaths[e];if(!i||i.nodeType===8)return;switch(t){case"class":i.classList.toggle(r,n),View.Counters.update.class++;break;case"style":var s=r.split(":"),o=s[0].trim();s.splice(0,1);var u=s.join(":");i.style[o]=u,View.Counters.update.style++;break;case"data":i.nodeType===3&&i.textContent!=r&&(i.textContent=r),View.Counters.update.data++;break;default:i.setAttribute(t,r),View.Counters.update.other++}},View.prototype.getElementByPath=function(e,t,n){n===void 0&&(n=!1);if(!this.element)throw Error("cant get element by path");if(n)return e;if(t&&t.length&&e&&e.childNodes.length){var r=t.splice(0,1)[0];return this.getElementByPath(e.childNodes[parseInt(r,10)],t)}return e},Object.defineProperty(View.prototype,"inDocument",{get:function(){return this._inDocument},enumerable:!0,configurable:!0}),View.prototype.enterDocument=function(){var e=this;if(this._inDocument)return;this._inDocument=!0;var t=this;this.isDynamicStylesEnabled()||this.enableDynamicStyle(!0),ViewHelper.setIfNotExistAttribute(this.element,"id",this.id),this.hasState(fmvc.State.HOVER)&&(this.dispatcher.listen(this.element,fmvc.BrowserEvent.MOUSEOVER,function(){return t.setState(fmvc.State.HOVER,!0)}),this.dispatcher.listen(this.element,fmvc.BrowserEvent.MOUSEOUT,function(){return t.setState(fmvc.State.HOVER,!1)})),this.hasState(fmvc.State.SELECTED)&&this.dispatcher.listen(this.element,fmvc.BrowserEvent.CLICK,function(){return t.setState(fmvc.State.SELECTED,!t.getState(fmvc.State.SELECTED))}),this.enterDocumentElement(this.jsTemplate,this.elementPaths),this.invalidate(3);var n=_.filter(_.keys(this.dynamicProperties),function(e){return e.indexOf("app.")===0}),r=_.map(n,function(e){return e.split(".")[1]});_.each(r,function(t){return e.app[t].bind(e,e.appModelHandler)},this)},View.prototype.appModelHandler=function(e){var t=this;if(!this._inDocument)return;console.log("AppModelHandler: ",e.target.name," view: ",this.name,", ",JSON.stringify(e.target.data));var n=e.target.name,r=_.filter(_.keys(this.dynamicProperties),function(e){return e.indexOf("app."+n)===0});_.each(r,function(e){return t.updateAppProp(e)},this),this.applyChangeStateElement(this.jsTemplate,this.elementPaths)},View.prototype.exitDocument=function(){var e=this,t=_.filter(_.keys(this.dynamicProperties),function(e){return e.indexOf("app.")===0}),n=_.map(t,function(e){return e.split(".")[1]});_.each(n,function(t){return e.app[t].unbind(e,e.appModelHandler)},this),this.dispatcher.unlistenAll(this.element),this._inDocument=!1},View.prototype.applyEventHandlers=function(e){var t=e.currentTarget.getAttribute("data-path"),n=this.handlers[t][e.type];e.stopPropagation();if(n==="stopPropagation")e.stopPropagation();else if(n.indexOf(",")){var r=n.split(",");if(r[0]==="set"){var i=r[1].split("."),s=i[1].trim();if(this.model){var o={};o[s]=e.target.value,this.model.data=o}this._data&&(this._data[s]=e.target.value)}}this.elementEventHandler(n,e)},View.prototype.elementEventHandler=function(e,t){this.mediator.viewEventHandler({name:e,target:this,event:t})},View.prototype.enterDocumentElement=function(e,t){if(!e||!t)return;var n=e.path,r=t[e.path],i=r.nodeType===1,s=this.componentPaths[e.path];s&&s.enterDocument();if(e.type===fmvc.DomObjectType.TAG&&i){_.each(e.children,function(e,n){this.enterDocumentElement(e,t)},this);if(e.handlers){var o=e.staticAttributes?e.staticAttributes.id:ViewHelper.getId();ViewHelper.setIfNotExistAttribute(r,"id",o),_.each(e.handlers,function(e,t){if(!this.handlers[n]||!this.handlers[n][t])this.handlers[n]||(this.handlers[n]={}),this.handlers[n][t]=e,r.setAttribute("data-path",n),this.dispatcher.listen(r,t,this.applyEventHandlers)},this)}}},View.prototype.exitDocumentElement=function(e,t){if(!e||!t)return;var n=e.path,r=t[e.path],i=r.nodeType===1,s=this.componentPaths[e.path];s&&s.exitDocument(),e.type===fmvc.DomObjectType.TAG&&i&&(_.each(e.children,function(e,n){this.exitDocumentElement(e,t)},this),e.handlers&&_.each(e.handlers,function(e,t){this.handlers[n]&&this.handlers[n][t]&&(this.dispatcher.unlisten(r,t),delete this.handlers[n][t])},this))},View.prototype.applyChangeStateElement=function(e,t){if(!e||!t)return;var n=t[e.path];n&&_.each(e.children,function(e,n){this.applyChangeStateElement(e,t)},this);var r=!!e.states;if(!r)return;var i=e.states?this.isStateEnabled(e.states):!0,s=n.nodeType===1;if(i&&!s){var o=this.getElement(e,t),u=n.parentNode;u.replaceChild(o,n),t[e.path]=o,this.enterDocumentElement(e,t),View.Counters.element.removed++}else if(!i&&s){this.exitDocumentElement(e,t);var o=this.getElement(e,t),u=n.parentNode;u.replaceChild(o,n),t[e.path]=o,View.Counters.element.removed++}},View.prototype.getFormattedMessage=function(e,t){return View.__formatter[e]=View.__formatter[e]?View.__formatter[e]:this.getCompiledFormatter(e),View.__formatter[e](t)},View.prototype.getCompiledFormatter=function(e){return View.__messageFormat[this.locale]=View.__messageFormat[this.locale]?View.__messageFormat[this.locale]:new MessageFormat(this.locale),View.__messageFormat[this.locale].compile(e)},View.prototype.hasState=function(e){return _.isBoolean(this._states[e])},View.prototype.setStates=function(e){var t=this;return _.each(e,function(e,n){return t.setState(n,e)},this),this},View.prototype.setState=function(e,t){return e in this._states?(e in this._statesType&&(t=View.getTypedValue(t,this._statesType[e])),this._states[e]===t?this:(this._states[e]=t,this.applyState(e,t),this.applyChildrenState(e,t),this.applyChangeStateElement(this.jsTemplate,this.elementPaths),this)):this},View.prototype.getState=function(e){return this._states[e]},View.prototype.applyState=function(e,t){if(!this.dynamicProperties)return;this._inDocument&&this.updateDynamicProperty(e,t)},View.prototype.applyChildrenState=function(e,t){},View.prototype.applyChildState=function(){},Object.defineProperty(View.prototype,"avaibleInheritedStates",{get:function(){return this._avaibleInheritedStates||(this._avaibleInheritedStates=_.filter(_.map(this._states,function(e,t){return t}),function(e){return this.inheritedStates.indexOf(e)>-1},this)),this._avaibleInheritedStates},enumerable:!0,configurable:!0}),Object.defineProperty(View.prototype,"inheritedStates",{get:function(){return View.__inheritedStates},enumerable:!0,configurable:!0}),View.prototype.isSelected=function(){return!!this.getState(fmvc.State.SELECTED)},View.prototype.isHover=function(){return!!this.getState(fmvc.State.HOVER)},View.prototype.isFocused=function(){return!!this.getState(fmvc.State.FOCUSED)},View.prototype.isDisabled=function(){return!!this.getState(fmvc.State.DISABLED)},View.prototype.invalidate=function(e){this._invalidate=this._invalidate|e,this._invalidateTimeout||(this._invalidateTimeout=setTimeout(this.invalidateHandler,20))},View.prototype.invalidateHandler=function(){var e=this;this.removeInvalidateTimeout();if(!this._invalidate||!this._inDocument)return;this._invalidate&1&&(this.updateData(this.data,"data.",2),this.updateApp()),this._invalidate&2&&_.each(this._states,function(t,n){return t?e.applyState(n,t):null},this),this._invalidate=0},View.prototype.removeInvalidateTimeout=function(){clearTimeout(this._invalidateTimeout),this._invalidateTimeout=null},Object.defineProperty(View.prototype,"mediator",{get:function(){return this._mediator},set:function(e){this._mediator=e},enumerable:!0,configurable:!0}),View.prototype.forEachChild=function(e){if(!this.childrenViews||!this.childrenViews.length)return;_.each(this.childrenViews,e,this)},View.prototype.addChild=function(e){this.childrenViews=this.childrenViews?this.childrenViews:[],this.childrenViews.push(e),e.render(this.childrenContainer)},View.prototype.removeChild=function(e){},View.prototype.removeAllChildren=function(){_.each(this.childrenViews,function(e){return e.dispose()});var e=this.childrenViews;return this.childrenViews=[],e},View.prototype.removeChildAt=function(e){},Object.defineProperty(View.prototype,"data",{get:function(){return this._data===null?View.__emptyData:this._data},set:function(e){this._data=e,this.invalidate(1)},enumerable:!0,configurable:!0}),Object.defineProperty(View.prototype,"model",{set:function(e){this._model=e,this.data=e.data},enumerable:!0,configurable:!0}),Object.defineProperty(View.prototype,"app",{get:function(){return this._mediator&&this._mediator.facade?this._mediator.facade.model:null},enumerable:!0,configurable:!0}),View.prototype.setModelWithListener=function(e){this.model=e,this.model.bind(this,this.modelHandler)},View.prototype.modelHandler=function(e,t){this.invalidate(1)},Object.defineProperty(View.prototype,"locale",{get:function(){return this._locale},set:function(e){this._locale=e},enumerable:!0,configurable:!0}),Object.defineProperty(View.prototype,"i18n",{get:function(){return this.jsTemplate&&this.jsTemplate.i18n&&this.locale?this.jsTemplate.i18n[this.locale]:null},enumerable:!0,configurable:!0}),View.prototype.sendEvent=function(e,t,n,r,i){t===void 0&&(t=null),n===void 0&&(n=null),r===void 0&&(r=null),i===void 0&&(i=!1),this._mediator&&this._mediator.internalHandler({name:e,data:t,global:i,target:this})},View.prototype.log=function(e,t){return this._mediator?this._mediator.facade.logger.add(this.name,e,t):console.log("[c]",this.name,e,t),this},View.prototype.viewEventsHandler=function(e,t){this.log("event "+e),this.sendEvent(e,t)},View.prototype.eventHandler=function(e,t){console.log(t,t.currentTarget),this.viewEventsHandler(e,t)},View.prototype.dispose=function(){this.model&&this.model.unbind(this,this.modelHandler),_super.prototype.dispose.call(this)},Object.defineProperty(View.prototype,"dynamicProperties",{get:function(){return this.jsTemplate?this.jsTemplate.dynamicSummary:null},enumerable:!0,configurable:!0}),View.prototype.isDynamicStylesEnabled=function(e){return!this.jsTemplate||!this.jsTemplate.css?!1:(_.isBoolean(e)&&(this.jsTemplate.css.enabled=e),this.jsTemplate.css.enabled)},View.prototype.enableDynamicStyle=function(e){var t=this.className+"__"+Math.random()+"Style";if(e&&!this.isDynamicStylesEnabled()){console.log(" *** enable dynamic style *** ",this.jsTemplate.css);var n=document.createElement("style");n.id=t,n.type="text/css",n.innerHTML=this.dynamicStyle,document.getElementsByTagName("head")[0].appendChild(n),this.isDynamicStylesEnabled(!0)}},Object.defineProperty(View.prototype,"dynamicStyle",{get:function(){return this.jsTemplate&&this.jsTemplate.css?this.jsTemplate.css.content:null},enumerable:!0,configurable:!0}),Object.defineProperty(View.prototype,"templateElement",{get:function(){return this.elementPaths={},this.getElement(this.jsTemplate,this.elementPaths)},enumerable:!0,configurable:!0}),View.prototype.isStateEnabled=function(e){return this.executeExpression(e)},View.prototype.executeEval=function(value){return eval(value)},View.prototype.getVarValue=function(v,ex){if(v.indexOf("data.")===0){var varName=v.replace("data.","");return this.data&&this.data[varName]?this.data[varName]:null}if(v.indexOf("app.")===0)return eval("this."+v);if(v.indexOf("$")===0){var varEx=ex.expressions[parseInt(v.replace("$",""),10)];return typeof varEx=="string"?this.executeEval(varEx):this.executeExpression(varEx)}if(v.indexOf(".")===-1||v.indexOf("state.")===0){var varName=v.replace("state.","");return this.getState(varName)}throw new Error("Not supported variable in "+this.name+", "+v)},View.prototype.executeMultiExpression=function(e){return _.reduce(e.vars,function(t,n){return t.replace("{"+n+"}",this.getVarValue(n,e))},e.result||"{$0}",this)},View.prototype.executeExpression=function(e){var t=this,n=null;if(e.args&&e.filters)n={},_.each(e.args,function(r,i){return n[i]=t.getVarValue(r,e)},this);else{if(!e.values)throw Error("Expression must has args and filter or values");var r=0,i=e.values.length;while(!n&&r<i)n=this.getVarValue(e.values[r],e),r++}return n=this.executeFilters(n,e.filters),n},View.prototype.getElement=function(e,t){var n=null,r=null,i=e.states?this.isStateEnabled(e.states):!0;if(i&&e.type===fmvc.DomObjectType.TAG){if(e.tagName.indexOf(".")>-1){var s=e.tagName.split("."),o=new fmvc.global[s[0]][s[1]];o.mediator=this.mediator,o.setStates(e.attribs),this.componentPaths[e.path]=o,e.link&&(this[e.link]=o),n=o.createDom().element}else n=document.createElement(e.tagName),_.each(e.staticAttributes,function(e,t){n.setAttribute(t,e)});_.each(e.children,function(e,r){var i=this.getElement(e,t);i&&n.appendChild(i)},this)}else e.type===fmvc.DomObjectType.TEXT?r=document.createTextNode(_.isString(e.data)?e.data:""):r=document.createComment(e.path);return View.Counters.element.added++,t[e.path]=n||r,n||r},Object.defineProperty(View.prototype,"jsTemplate",{get:function(){return View.__jsTemplate},enumerable:!0,configurable:!0}),Object.defineProperty(View.prototype,"className",{get:function(){return View.__className},enumerable:!0,configurable:!0}),Object.defineProperty(View.prototype,"dispatcher",{get:function(){return View.dispatcher},enumerable:!0,configurable:!0}),View.getTypedValue=function(e,t){switch(t){case fmvc.Type.String:return _.isString(e)?e:String(e);case fmvc.Type.Int:return parseInt(e,10);case fmvc.Type.Float:return parseFloat(e);case fmvc.Type.Boolean:return e===!0||e==="true"}},View.__isDynamicStylesEnabled=!1,View.__jsTemplate=null,View.__formatter={},View.__messageFormat={},View.__className="View",View.__inheritedStates=[fmvc.State.DISABLED],View.__emptyData={},View.Counters={element:{added:0,removed:0,handlers:0},update:{"class":0,data:0,style:0,other:0}},View.dispatcher=new fmvc.EventDispatcher,View.Name="View",View}(fmvc.Notifier);fmvc.View=View;var ViewHelper=function(){function e(){}return e.getId=function(e){return e===void 0&&(e=View.Name),"id_"+View.Counters.element.handlers++},e.checkElementAttribute=function(e,t,n){if(!e||!t)return;e.getAttribute(t)!==String(n)&&e.setAttribute(t,n)},e.setIfNotExistAttribute=function(e,t,n){if(!e||!t)return;return e.getAttribute(t)?!1:(e.setAttribute(t,n),!0)},e.hhmmss=function(e){e=parseInt(e);var t=Math.floor(e/3600);e-=t*3600;var n=Math.floor(e/60);e-=n*60;var r=Math.floor(e%60);t=t<10?"0"+t:t,n=n<10?"0"+n:n,r=r<10?"0"+r:r;var i=e>=3600?[t,n,r]:[n,r];return i.join(":")},e}();fmvc.ViewHelper=ViewHelper,setInterval(function(){console.log(JSON.stringify(View.Counters))},3e3)})(fmvc||(fmvc={})),define("../src/fmvc/view.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},fmvc;(function(e){var t=function(e){function t(t,n){e.call(this,t,n)}return __extends(t,e),Object.defineProperty(t.prototype,"childrenConstructor",{set:function(e){this.ChildrenConstructor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataset",{get:function(){return this._dataset},set:function(e){this._dataset=e,this.invalidate(8)},enumerable:!0,configurable:!0}),t.prototype.applyChildrenState=function(e,t){if(!this.avaibleInheritedStates||this.avaibleInheritedStates.indexOf(e)===-1)return;this.forEachChild(function(n,r){this.applyViewState(e,t,n,r)})},t.prototype.applyViewState=function(e,t,n,r){n.setState(e,t)},t.prototype.updateChildren=function(){if(!this.inDocument)return;var e=this.removeAllChildren()||[];_.each(this.dataset,function(t,n){var r=e[n]||new this.ChildrenConstructor;r.data=t,_.each(this.avaibleInheritedStates,function(e){r.setState(e,this.getState(e))},this),r.inDocument||this.addChild(r)},this)},t}(e.View);e.ViewList=t})(fmvc||(fmvc={})),define("../src/fmvc/view.list.js",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},ui;(function(e){var t=function(e){function t(t,n,r){e.call(this,t,n,r)}return __extends(t,e),t.prototype.createDom=function(){return this.element=this.templateElement,this.childrenContainer=this.childrenContainer||this.element,this},Object.defineProperty(t.prototype,"jsTemplate",{get:function(){return t.__jsTemplate},enumerable:!0,configurable:!0}),t.__jsTemplate={path:"0",type:"tag",attribs:{className:"Button",extend:"fmvc.View",enableStates:"hover,selected,disabled,error,open","class":{"static":["button"],dynamic:{selected:["button-{selected}"],disabled:["button-{disabled}"],hover:["button-{hover}"],error:["button-{error}"],open:["button-{open}"],exClass:["{exClass}"]},bounds:null}},staticAttributes:{"class":"button"},children:[{path:"0,0",type:"text",data:{content:"\n    {(state.content||data.content)}\n",result:"\n    {$0}\n",vars:["$0"],expressions:[{content:"(state.content||data.content)",vars:["state.content","data.content","$0"],values:["$0"],expressions:['(this.getState("content")||this.data.content)']}]},attribs:{}}],dynamicSummary:{selected:{"class":{0:"button-{selected}"}},disabled:{"class":{0:"button-{disabled}"}},hover:{"class":{0:"button-{hover}"}},error:{"class":{0:"button-{error}"}},open:{"class":{0:"button-{open}"}},exClass:{"class":{0:"{exClass}"}},"state.content":{data:{"0,0":{content:"\n    {(state.content||data.content)}\n",result:"\n    {$0}\n",vars:["$0"],expressions:[{content:"(state.content||data.content)",vars:["state.content","data.content","$0"],values:["$0"],expressions:['(this.getState("content")||this.data.content)']}]}}},"data.content":{data:{"0,0":{content:"\n    {(state.content||data.content)}\n",result:"\n    {$0}\n",vars:["$0"],expressions:[{content:"(state.content||data.content)",vars:["state.content","data.content","$0"],values:["$0"],expressions:['(this.getState("content")||this.data.content)']}]}}}},tagName:"div",enableStates:["hover","selected","disabled","error","open",{name:"content",type:"string","default":""},{name:"exClass",type:"string","default":""}],extend:"fmvc.View",className:"Button",moduleName:"ui"},t}(fmvc.View);e.Button=t})(ui||(ui={})),define("../src/ui-out/Button.js",function(){}),require(["../src/fmvc/event.js","../src/fmvc/notifier.js","../src/fmvc/event.dispatcher.js","../src/fmvc/facade.js","../src/fmvc/model.js","../src/fmvc/model.list.js","../src/fmvc/logger.js","../src/fmvc/mediator.js","../src/fmvc/view.i.js","../src/fmvc/view.js","../src/fmvc/view.list.js","../src/ui-out/Button.js"],function(e,t,n,r,i,s,o){console.log("[fmvc] Core with message format, Button is loaded.")}),define("package.fmvc",function(){});